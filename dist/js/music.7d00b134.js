"use strict";(self["webpackChunkwavetune"]=self["webpackChunkwavetune"]||[]).push([[692],{81:function(e,t,a){var r=a(9565),l=a(9306),i=a(8551),s=a(6823),o=a(851),n=TypeError;e.exports=function(e,t){var a=arguments.length<2?o(e):t;if(l(a))return i(r(a,e));throw new n(s(e)+" is not iterable")}},655:function(e,t,a){var r=a(6955),l=String;e.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return l(e)}},851:function(e,t,a){var r=a(6955),l=a(5966),i=a(4117),s=a(6269),o=a(8227),n=o("iterator");e.exports=function(e){if(!i(e))return l(e,n)||l(e,"@@iterator")||s[r(e)]}},1148:function(e,t,a){var r=a(6518),l=a(9565),i=a(2652),s=a(9306),o=a(8551),n=a(1767),c=a(9539),u=a(4549),d=u("every",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:d},{every:function(e){o(this);try{s(e)}catch(r){c(this,"throw",r)}if(d)return l(d,this,e);var t=n(this),a=0;return!i(t,function(t,r){if(!e(t,a++))return r()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1701:function(e,t,a){var r=a(6518),l=a(9565),i=a(9306),s=a(8551),o=a(1767),n=a(9462),c=a(6319),u=a(9539),d=a(684),v=a(4549),g=a(6395),h=!g&&!d("map",function(){}),p=!g&&!h&&v("map",TypeError),m=g||h||p,f=n(function(){var e=this.iterator,t=s(l(this.next,e)),a=this.done=!!t.done;if(!a)return c(e,this.mapper,[t.value,this.counter++],!0)});r({target:"Iterator",proto:!0,real:!0,forced:m},{map:function(e){s(this);try{i(e)}catch(t){u(this,"throw",t)}return p?l(p,this,e):new f(o(this),{mapper:e})}})},2140:function(e,t,a){var r=a(8227),l=r("toStringTag"),i={};i[l]="z",e.exports="[object z]"===String(i)},2652:function(e,t,a){var r=a(6080),l=a(9565),i=a(8551),s=a(6823),o=a(4209),n=a(6198),c=a(1625),u=a(81),d=a(851),v=a(9539),g=TypeError,h=function(e,t){this.stopped=e,this.result=t},p=h.prototype;e.exports=function(e,t,a){var m,f,k,y,b,w,L,M=a&&a.that,_=!(!a||!a.AS_ENTRIES),F=!(!a||!a.IS_RECORD),C=!(!a||!a.IS_ITERATOR),E=!(!a||!a.INTERRUPTED),P=r(t,M),T=function(e){return m&&v(m,"normal"),new h(!0,e)},x=function(e){return _?(i(e),E?P(e[0],e[1],T):P(e[0],e[1])):E?P(e,T):P(e)};if(F)m=e.iterator;else if(C)m=e;else{if(f=d(e),!f)throw new g(s(e)+" is not iterable");if(o(f)){for(k=0,y=n(e);y>k;k++)if(b=x(e[k]),b&&c(p,b))return b;return new h(!1)}m=u(e,f)}w=F?e.next:m.next;while(!(L=l(w,m)).done){try{b=x(L.value)}catch(R){v(m,"throw",R)}if("object"==typeof b&&b&&c(p,b))return b}return new h(!1)}},2812:function(e){var t=TypeError;e.exports=function(e,a){if(e<a)throw new t("Not enough arguments");return e}},3368:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ve}});a(4114);var r=a(641),l=a(33),i=a(3751);const s={class:"music-recommendation-view"},o={class:"recommendation-header"},n={class:"header-content"},c={class:"header-text"},u={class:"main-text"},d={class:"recommendation-basis"},v={style:{display:"flex","align-items":"center",gap:"12px"}},g={class:"music-grid"},h={key:0,class:"skeleton-grid"},p={class:"cover-section"},m={class:"image-error"},f={class:"match-badge"},k=["onClick","aria-label"],y={class:"info-section"},b={class:"music-title"},w={class:"music-artist"},L={class:"music-meta"},M={class:"music-duration"},_={class:"music-reason"},F={key:0,class:"empty-state"},C={class:"empty-container"},E={key:1,ref:"loadMoreTrigger",class:"load-more-trigger"},P={key:2,class:"all-loaded"},T={key:3,class:"load-more-section"},x={class:"dialog-content"},R={class:"left-section"},S={class:"cover-wrapper"},V={class:"cover-container"},I={class:"cover-placeholder"},U={class:"audio-upload"},A={class:"upload-btn-group"},D={key:0,class:"progress-container"},N={class:"progress-text"},$={class:"file-info"},W={class:"file-name"},O={class:"right-section"},X={class:"cover-setting"},z={class:"cover-btn-group"},K={key:0,class:"cover-file-info"},Q={class:"dialog-footer",style:{display:"flex","justify-content":"flex-end",gap:"12px"}};function j(e,t,a,j,B,H){const q=(0,r.g2)("el-tag"),G=(0,r.g2)("Upload"),Y=(0,r.g2)("el-icon"),J=(0,r.g2)("el-button"),Z=(0,r.g2)("el-col"),ee=(0,r.g2)("el-row"),te=(0,r.g2)("Headset"),ae=(0,r.g2)("el-image"),re=(0,r.g2)("VideoPlay"),le=(0,r.g2)("el-skeleton-item"),ie=(0,r.g2)("el-skeleton"),se=(0,r.g2)("MusicPlayer"),oe=(0,r.g2)("Microphone"),ne=(0,r.g2)("UploadFilled"),ce=(0,r.g2)("Loading"),ue=(0,r.g2)("el-progress"),de=(0,r.g2)("el-input"),ve=(0,r.g2)("el-form-item"),ge=(0,r.g2)("el-option"),he=(0,r.g2)("el-select"),pe=(0,r.g2)("Picture"),me=(0,r.g2)("el-form"),fe=(0,r.g2)("Check"),ke=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",s,[t[26]||(t[26]=(0,r.Lk)("div",{class:"wave-bg-container"},[(0,r.Lk)("div",{class:"wave-bg wave-bg-1"}),(0,r.Lk)("div",{class:"wave-bg wave-bg-2"}),(0,r.Lk)("div",{class:"wave-bg wave-bg-3"})],-1)),(0,r.Lk)("div",o,[(0,r.Lk)("div",n,[(0,r.Lk)("div",c,[(0,r.Lk)("h2",u,[t[16]||(t[16]=(0,r.eW)(" ‰∏∫ÊÇ®Êé®ËçêÈÄÇÂêàÂΩìÂâçÁä∂ÊÄÅÁöÑËΩªÈü≥‰πê ",-1)),(0,r.Lk)("span",d,"ÔºàÂü∫‰∫é "+(0,l.v_)(B.currentFatigueLevel)+" Áñ≤Âä≥Á≠âÁ∫ßÔºâ",1)]),t[17]||(t[17]=(0,r.Lk)("p",{class:"sub-text"},"ÁÇπÂáªÂç°ÁâáÂèØÊü•ÁúãËØ¶ÊÉÖ",-1))]),(0,r.Lk)("div",v,[(0,r.bF)(q,{class:"fatigue-tag",type:H.fatigueTagType,size:"large"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(B.currentFatigueLevel)+" Áñ≤Âä≥‰∏ìÂ±û",1)]),_:1},8,["type"]),(0,r.bF)(J,{type:"primary",plain:"",size:"small",onClick:H.openAddDialog,class:"add-music-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(Y,null,{default:(0,r.k6)(()=>[(0,r.bF)(G)]),_:1}),t[18]||(t[18]=(0,r.eW)("Ê∑ªÂä†Èü≥‰πê ",-1))]),_:1},8,["onClick"])])])]),(0,r.Lk)("div",g,[B.loading?((0,r.uX)(),(0,r.CE)("div",h,[(0,r.bF)(ee,{gutter:16},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(6,e=>(0,r.bF)(Z,{key:e,xs:24,sm:12,md:8,lg:6,xl:6},{default:(0,r.k6)(()=>[...t[19]||(t[19]=[(0,r.Lk)("div",{class:"music-card skeleton"},[(0,r.Lk)("div",{class:"cover-section"},[(0,r.Lk)("div",{class:"skeleton-cover"})]),(0,r.Lk)("div",{class:"info-section"},[(0,r.Lk)("div",{class:"skeleton-line short"}),(0,r.Lk)("div",{class:"skeleton-line"})])],-1)])]),_:1})),64))]),_:1})])):(0,r.Q3)("",!0),B.displayedMusicList.length>0?((0,r.uX)(),(0,r.Wv)(ee,{key:1,gutter:16},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(B.displayedMusicList,e=>((0,r.uX)(),(0,r.Wv)(Z,{key:`${e.id||Math.random()}`,xs:24,sm:12,md:8,lg:6,xl:6,class:"music-col"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",{class:"music-card business-card",ref_for:!0,ref:e=>e&&H.observeMusicCard(e)},[(0,r.Lk)("div",p,[(0,r.bF)(ae,{src:H.getCoverUrl(e),alt:`${e.title||"Êú™Áü•Ê≠åÊõ≤"} - ${e.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂"}`,class:"music-cover",fit:"cover",lazy:!1,onError:t=>H.handleImageError(t,e),onLoad:t[0]||(t[0]=e=>e.target.classList.add("is-loaded"))},{error:(0,r.k6)(()=>[(0,r.Lk)("div",m,[(0,r.bF)(te,{class:"music-icon"})])]),_:1},8,["src","alt","onError"]),(0,r.Lk)("div",f,(0,l.v_)(e.match_rate)+"% ÂåπÈÖç ",1),(0,r.Lk)("button",{class:"play-button",type:"button",onClick:(0,i.D$)(t=>H.playTrack(e),["stop"]),"aria-label":"Êí≠Êîæ "+(e.title||"Ê≠åÊõ≤")},[(0,r.bF)(re,{class:"play-svg-icon"})],8,k),(0,r.bF)(J,{class:"delete-music-btn",type:"danger",size:"small",onClick:(0,i.D$)(t=>H.deleteMusic(e.id),["stop"])},{default:(0,r.k6)(()=>[...t[20]||(t[20]=[(0,r.eW)("Âà†Èô§",-1)])]),_:1},8,["onClick"])]),(0,r.Lk)("div",y,[(0,r.Lk)("h3",b,(0,l.v_)(e.title),1),(0,r.Lk)("p",w,(0,l.v_)(e.artist),1),(0,r.Lk)("div",L,[(0,r.Lk)("span",M,(0,l.v_)(e.duration),1)]),(0,r.Lk)("p",_,(0,l.v_)(e.reason),1)])],512)]),_:2},1024))),128))]),_:1})):(0,r.Q3)("",!0)]),0!==B.musicList.length||B.loading?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",F,[(0,r.Lk)("div",C,[(0,r.bF)(te,{class:"empty-icon"}),t[22]||(t[22]=(0,r.Lk)("p",{class:"empty-text"},"ÊöÇÊó†Êé®ËçêÈü≥‰πê",-1)),t[23]||(t[23]=(0,r.Lk)("p",{class:"empty-subtext"},"ËØ∑ÂÖàÂÆåÊàêËÑëÁñ≤Âä≥Ê£ÄÊµã‰ª•Ëé∑Âæó‰∏™ÊÄßÂåñÊé®Ëçê",-1)),(0,r.bF)(J,{type:"primary",onClick:t[1]||(t[1]=t=>e.$router.push("/signal-monitor")),class:"primary-button"},{default:(0,r.k6)(()=>[...t[21]||(t[21]=[(0,r.eW)(" ÂâçÂæÄÊ£ÄÊµã ",-1)])]),_:1})])])),H.hasMoreMusic?((0,r.uX)(),(0,r.CE)("div",E,[(0,r.bF)(ie,{loading:B.isLoadingMore,animated:""},{default:(0,r.k6)(()=>[(0,r.bF)(le,{variant:"text",style:{width:"30%","margin-bottom":"15px"}})]),_:1},8,["loading"])],512)):B.displayedMusicList.length>0?((0,r.uX)(),(0,r.CE)("div",P,[...t[24]||(t[24]=[(0,r.Lk)("p",null,"Â∑≤ÊòæÁ§∫ÂÖ®ÈÉ®Êé®ËçêÈü≥‰πê",-1)])])):(0,r.Q3)("",!0),B.currentPage<H.totalPages&&!B.loading?((0,r.uX)(),(0,r.CE)("div",T,[(0,r.bF)(J,{type:"primary",plain:"",onClick:H.loadMoreMusic,class:"load-more-btn"},{default:(0,r.k6)(()=>[...t[25]||(t[25]=[(0,r.eW)(" Âä†ËΩΩÊõ¥Â§ö ",-1)])]),_:1},8,["onClick"])])):(0,r.Q3)("",!0)]),B.showPlayer?((0,r.uX)(),(0,r.Wv)(se,{key:0,track:B.selectedTrack,autoPlay:B.autoPlay,onClose:t[2]||(t[2]=e=>B.showPlayer=!1)},null,8,["track","autoPlay"])):(0,r.Q3)("",!0),(0,r.bF)(ke,{title:"Ê∑ªÂä†Èü≥‰πê",modelValue:B.showAddDialog,"onUpdate:modelValue":t[15]||(t[15]=e=>B.showAddDialog=e),width:"600px","append-to-body":"",class:"custom-add-music-dialog",style:{"z-index":"10000"}},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",Q,[(0,r.bF)(J,{class:"cancel-button",onClick:t[14]||(t[14]=e=>B.showAddDialog=!1)},{default:(0,r.k6)(()=>[...t[36]||(t[36]=[(0,r.eW)("ÂèñÊ∂à",-1)])]),_:1}),(0,r.bF)(J,{type:"primary",disabled:B.uploading,onClick:H.addMusic,style:{"margin-left":"12px"}},{default:(0,r.k6)(()=>[(0,r.bF)(Y,null,{default:(0,r.k6)(()=>[(0,r.bF)(fe)]),_:1}),t[37]||(t[37]=(0,r.eW)("Ê∑ªÂä†Èü≥‰πê ",-1))]),_:1},8,["disabled","onClick"])])]),default:(0,r.k6)(()=>[(0,r.bF)(me,{"label-width":"80px",class:"music-form"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",x,[(0,r.Lk)("div",R,[(0,r.Lk)("div",S,[(0,r.Lk)("div",V,[(0,r.bF)(ae,{src:B.newMusic.cover?H.resolveMediaUrl(B.newMusic.cover):H.resolveMediaUrl("/static/music_cover/1.png"),fit:"cover",class:"cover-image"},{error:(0,r.k6)(()=>[(0,r.Lk)("div",I,[(0,r.bF)(te,{class:"placeholder-icon"}),t[27]||(t[27]=(0,r.Lk)("span",{class:"placeholder-text"},"Â∞ÅÈù¢È¢ÑËßà",-1))])]),_:1},8,["src"]),t[28]||(t[28]=(0,r.Lk)("div",{class:"cover-ring"},null,-1))])]),(0,r.Lk)("div",U,[t[30]||(t[30]=(0,r.Lk)("h4",{class:"upload-title"},"Èü≥È¢ë‰∏ä‰º†",-1)),(0,r.Lk)("div",A,[(0,r.Lk)("input",{type:"file",accept:"audio/*",ref:"fileInput",onChange:t[3]||(t[3]=(...e)=>H.onFileChange&&H.onFileChange(...e)),class:"hidden-input"},null,544),(0,r.bF)(J,{size:"small",class:"select-audio-btn",onClick:t[4]||(t[4]=t=>e.$refs.fileInput.click())},{default:(0,r.k6)(()=>[(0,r.bF)(Y,null,{default:(0,r.k6)(()=>[(0,r.bF)(oe)]),_:1}),t[29]||(t[29]=(0,r.eW)("ÈÄâÊã©Èü≥È¢ë ",-1))]),_:1}),(0,r.bF)(J,{size:"small",type:"primary",loading:B.uploading,onClick:H.uploadFile,disabled:!B.selectedFile},{default:(0,r.k6)(()=>[B.uploading?((0,r.uX)(),(0,r.Wv)(Y,{key:1},{default:(0,r.k6)(()=>[(0,r.bF)(ce)]),_:1})):((0,r.uX)(),(0,r.Wv)(Y,{key:0},{default:(0,r.k6)(()=>[(0,r.bF)(ne)]),_:1})),(0,r.eW)(" "+(0,l.v_)(B.uploading?"‰∏ä‰º†‰∏≠":"‰∏ä‰º†"),1)]),_:1},8,["loading","onClick","disabled"])]),B.uploading?((0,r.uX)(),(0,r.CE)("div",D,[(0,r.bF)(ue,{percentage:B.uploadProgress,"stroke-width":"2",class:"progress-bar"},null,8,["percentage"]),(0,r.Lk)("span",N,(0,l.v_)(B.uploadProgress)+"%",1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",$,[(0,r.Lk)("span",W,(0,l.v_)(B.selectedFileName||"Êú™ÈÄâÊã©Êñá‰ª∂"),1)]),t[31]||(t[31]=(0,r.Lk)("p",{class:"upload-hint"},"ÊîØÊåÅ MP3„ÄÅWAV Ê†ºÂºèÔºåÊñá‰ª∂Â§ßÂ∞è‰∏çË∂ÖËøá 50MB",-1))])]),(0,r.Lk)("div",O,[(0,r.bF)(ve,{label:"Ê†áÈ¢ò",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.bF)(de,{modelValue:B.newMusic.title,"onUpdate:modelValue":t[5]||(t[5]=e=>B.newMusic.title=e),placeholder:"ËØ∑ËæìÂÖ•Èü≥‰πêÊ†áÈ¢ò",class:"form-control"},null,8,["modelValue"])]),_:1}),(0,r.bF)(ve,{label:"Ëâ∫ÊúØÂÆ∂",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.bF)(de,{modelValue:B.newMusic.artist,"onUpdate:modelValue":t[6]||(t[6]=e=>B.newMusic.artist=e),placeholder:"ËØ∑ËæìÂÖ•Ëâ∫ÊúØÂÆ∂/Âàõ‰ΩúËÄÖ",class:"form-control"},null,8,["modelValue"])]),_:1}),(0,r.bF)(ve,{label:"Êó∂Èïø",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.bF)(de,{modelValue:B.newMusic.duration,"onUpdate:modelValue":t[7]||(t[7]=e=>B.newMusic.duration=e),placeholder:"Ê†ºÂºè 05:30",class:"form-control"},null,8,["modelValue"]),t[32]||(t[32]=(0,r.Lk)("p",{class:"form-hint"},"Ëã•Êú™Â°´ÂÜôÔºå‰∏ä‰º†ÂêéÂ∞ÜËá™Âä®Ëé∑Âèñ",-1))]),_:1}),(0,r.bF)(ve,{label:"Èü≥‰πêÁ±ªÂûã",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.bF)(he,{modelValue:B.newMusic.music_type,"onUpdate:modelValue":t[8]||(t[8]=e=>B.newMusic.music_type=e),placeholder:"ÈÄâÊã©Èü≥‰πêÁ±ªÂûã",style:{width:"180px"}},{default:(0,r.k6)(()=>[(0,r.bF)(ge,{label:"Ëá™ÁÑ∂ / Natural",value:"natural"}),(0,r.bF)(ge,{label:"Èí¢Áê¥ / Piano",value:"piano"}),(0,r.bF)(ge,{label:"ÁôΩÂô™Èü≥ / WhiteNoise",value:"whitenoise"}),(0,r.bF)(ge,{label:"Ê∑∑Âêà / Mix",value:"mix"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(ve,{label:"ÈÄÇÁî®Áñ≤Âä≥Á®ãÂ∫¶",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.bF)(he,{modelValue:B.newMusic.fatigue_level,"onUpdate:modelValue":t[9]||(t[9]=e=>B.newMusic.fatigue_level=e),placeholder:"ÈÄâÊã©ÈÄÇÁî®Áñ≤Âä≥Á®ãÂ∫¶",style:{width:"180px"}},{default:(0,r.k6)(()=>[(0,r.bF)(ge,{label:"ËΩªÂ∫¶ÔºàLightÔºâ",value:"light"}),(0,r.bF)(ge,{label:"‰∏≠Â∫¶ÔºàMediumÔºâ",value:"medium"}),(0,r.bF)(ge,{label:"ÈáçÂ∫¶ÔºàHeavyÔºâ",value:"heavy"})]),_:1},8,["modelValue"]),t[33]||(t[33]=(0,r.Lk)("p",{class:"form-hint"},"ËØ∑ÈÄâÊã©ËøôÈ¶ñÊ≠åÈÄÇÂêàÁöÑÁñ≤Âä≥Á≠âÁ∫ßÔºàÁïåÈù¢ÊòæÁ§∫‰∏∫‰∏≠ÊñáÔºâ",-1))]),_:1}),(0,r.bF)(ve,{label:"Â∞ÅÈù¢ËÆæÁΩÆ",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",X,[(0,r.bF)(de,{modelValue:B.newMusic.cover,"onUpdate:modelValue":t[10]||(t[10]=e=>B.newMusic.cover=e),placeholder:"Â∞ÅÈù¢ÂõæÁâá URLÔºàÂèØÈÄâÔºâ",class:"cover-url-input",style:{"margin-bottom":"8px"}},null,8,["modelValue"]),(0,r.Lk)("div",z,[(0,r.Lk)("input",{type:"file",accept:"image/*",ref:"coverInput",onChange:t[11]||(t[11]=(...e)=>H.onCoverChange&&H.onCoverChange(...e)),class:"hidden-input"},null,544),(0,r.bF)(J,{size:"small",class:"select-cover-btn",onClick:t[12]||(t[12]=t=>e.$refs.coverInput.click())},{default:(0,r.k6)(()=>[(0,r.bF)(Y,null,{default:(0,r.k6)(()=>[(0,r.bF)(pe)]),_:1}),t[34]||(t[34]=(0,r.eW)("ÈÄâÊã©ÂõæÁâá ",-1))]),_:1}),(0,r.bF)(J,{size:"small",type:"primary",loading:B.uploadingCover,onClick:H.uploadCover,disabled:!B.selectedCoverFile},{default:(0,r.k6)(()=>[B.uploadingCover?((0,r.uX)(),(0,r.Wv)(Y,{key:1},{default:(0,r.k6)(()=>[(0,r.bF)(ce)]),_:1})):((0,r.uX)(),(0,r.Wv)(Y,{key:0},{default:(0,r.k6)(()=>[(0,r.bF)(ne)]),_:1})),t[35]||(t[35]=(0,r.eW)(" ‰∏ä‰º†Â∞ÅÈù¢ ",-1))]),_:1},8,["loading","onClick","disabled"])])]),B.selectedCoverFileName?((0,r.uX)(),(0,r.CE)("div",K,"Â∑≤ÈÄâÂ∞ÅÈù¢Ôºö"+(0,l.v_)(B.selectedCoverFileName),1)):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(ve,{label:"Êé®ËçêÁêÜÁî±",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.bF)(de,{type:"textarea",modelValue:B.newMusic.reason,"onUpdate:modelValue":t[13]||(t[13]=e=>B.newMusic.reason=e),placeholder:`ËØ¥Êòé‰∏∫‰ªÄ‰πàËøôÈ¶ñÊ≠åÈÄÇÂêà${B.currentFatigueLevel}Áñ≤Âä≥Áä∂ÊÄÅ...`,rows:"4",class:"form-control form-textarea"},null,8,["modelValue","placeholder"])]),_:1})])])]),_:1})]),_:1},8,["modelValue"])],64)}a(8111),a(1148),a(2489),a(7588),a(1701),a(4603),a(7566),a(8721);var B=a(8548);const H={class:"player-main"},q={class:"record-container"},G={class:"record"},Y=["src"],J={class:"meta-controls"},Z={class:"meta"},ee=["title"],te=["data-text"],ae=["title"],re=["title"],le={class:"progress-container"},ie={class:"progress-bar-wrapper"},se=["max","value"],oe={class:"time-display"},ne={class:"current-time"},ce={class:"total-time"},ue={class:"controls"},de=["aria-label"],ve={class:"volume-controls"},ge=["aria-pressed","title"],he={key:0},pe={key:1},me={key:2},fe={key:3},ke=["src"];function ye(e,t,a,s,o,n){const c=(0,r.g2)("VideoPlay"),u=(0,r.g2)("el-icon"),d=(0,r.g2)("VideoPause"),v=(0,r.g2)("Close");return a.track?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,l.C4)(["music-player",{"dark-mode":s.isDarkMode}]),style:(0,l.Tr)({width:s.playerWidth})},[(0,r.Lk)("div",{class:"bg-overlay",style:(0,l.Tr)({backgroundImage:`linear-gradient(to top, ${s.getAccentColor}20, transparent)`})},null,4),(0,r.Lk)("div",{class:"player-accent",style:(0,l.Tr)({background:s.getAccentGradient})},null,4),(0,r.Lk)("div",H,[(0,r.Lk)("div",q,[(0,r.Lk)("div",{class:(0,l.C4)(["record-wrapper",{playing:s.isPlaying}])},[(0,r.Lk)("div",G,[(0,r.Lk)("img",{src:a.track.cover,alt:"‰∏ìËæëÂ∞ÅÈù¢",class:"record-cover",loading:"lazy"},null,8,Y),t[11]||(t[11]=(0,r.Lk)("div",{class:"record-texture"},null,-1)),t[12]||(t[12]=(0,r.Lk)("div",{class:"record-center"},[(0,r.Lk)("div",{class:"spindle"})],-1))])],2),(0,r.Lk)("div",{class:(0,l.C4)(["tonearm",{playing:s.isPlaying}])},null,2)]),(0,r.Lk)("div",J,[(0,r.Lk)("div",Z,[(0,r.Lk)("h2",{class:"title",title:a.track.title},[(0,r.Lk)("span",{class:"text","data-text":a.track.title},(0,l.v_)(a.track.title),9,te)],8,ee),(0,r.Lk)("p",{class:"artist",title:a.track.artist},(0,l.v_)(a.track.artist),9,ae),a.track.reason?((0,r.uX)(),(0,r.CE)("p",{key:0,class:"reason",title:a.track.reason},[t[13]||(t[13]=(0,r.Lk)("span",{class:"reason-icon"},"‚ô™",-1)),(0,r.eW)(" "+(0,l.v_)(a.track.reason),1)],8,re)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",le,[(0,r.Lk)("div",ie,[(0,r.Lk)("div",{class:"progress-indicator",style:(0,l.Tr)({width:(s.duration>0?s.currentTime/s.duration*100:0)+"%"})},null,4),(0,r.Lk)("input",{ref:"progressSlider",type:"range",min:"0",max:s.duration||100,step:"0.1",value:s.currentTime,onInput:t[0]||(t[0]=(...e)=>s.handleProgressInput&&s.handleProgressInput(...e)),onChange:t[1]||(t[1]=(...e)=>s.handleProgressChange&&s.handleProgressChange(...e)),class:"progress-slider","aria-label":"Êí≠ÊîæËøõÂ∫¶"},null,40,se)]),(0,r.Lk)("div",oe,[(0,r.Lk)("span",ne,(0,l.v_)(s.formatTime(s.currentTime)),1),(0,r.Lk)("span",ce,(0,l.v_)(s.formatTime(s.duration)),1)])]),(0,r.Lk)("div",ue,[(0,r.Lk)("button",{class:"play-btn",onClick:t[2]||(t[2]=(...e)=>s.togglePlay&&s.togglePlay(...e)),"aria-label":s.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:(0,l.Tr)({background:s.getAccentGradient})},[s.isPlaying?((0,r.uX)(),(0,r.Wv)(u,{key:1,class:"pause-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(d)]),_:1})):((0,r.uX)(),(0,r.Wv)(u,{key:0,class:"play-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:1}))],12,de),(0,r.Lk)("div",ve,[(0,r.Lk)("button",{class:"mute-btn",onClick:t[3]||(t[3]=(...e)=>s.toggleMute&&s.toggleMute(...e)),"aria-pressed":s.isMuted,title:s.isMuted?"ÂèñÊ∂àÈùôÈü≥":"ÈùôÈü≥"},[s.isMuted?((0,r.uX)(),(0,r.CE)("span",he,"üîá")):s.volume>=.66?((0,r.uX)(),(0,r.CE)("span",pe,"üîä")):s.volume>=.33?((0,r.uX)(),(0,r.CE)("span",me,"üîâ")):((0,r.uX)(),(0,r.CE)("span",fe,"üîà"))],8,ge),(0,r.bo)((0,r.Lk)("input",{type:"range",min:"0",max:"1",step:"0.01","onUpdate:modelValue":t[4]||(t[4]=e=>s.volume=e),onInput:t[5]||(t[5]=(...e)=>s.setVolume&&s.setVolume(...e)),class:"volume-slider","aria-label":"Èü≥ÈáèË∞ÉËäÇ"},null,544),[[i.Jo,s.volume,void 0,{number:!0}]])])])]),(0,r.Lk)("button",{class:"close-btn",onClick:t[6]||(t[6]=(...e)=>s.handleClose&&s.handleClose(...e)),"aria-label":"ÂÖ≥Èó≠Êí≠ÊîæÂô®"},[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1})])]),(0,r.Lk)("audio",{ref:"audioEl",src:a.track.src,onTimeupdate:t[7]||(t[7]=(...e)=>s.onTimeUpdate&&s.onTimeUpdate(...e)),onLoadedmetadata:t[8]||(t[8]=(...e)=>s.onLoaded&&s.onLoaded(...e)),onEnded:t[9]||(t[9]=(...e)=>s.onEnded&&s.onEnded(...e)),onError:t[10]||(t[10]=(...e)=>s.handleAudioError&&s.handleAudioError(...e)),class:"audio-element"}," ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅHTML5Èü≥È¢ëÊí≠Êîæ ",40,ke)],6)):(0,r.Q3)("",!0)}a(3579);var be=a(953),we={name:"MusicPlayer",components:{VideoPlay:B.VideoPlay,VideoPause:B.VideoPause,Close:B.Close},props:{track:{type:Object,required:!0,validator:e=>e&&e.title&&e.artist&&e.src},autoPlay:{type:Boolean,default:!1},accentColor:{type:String,default:"#10b981"}},emits:["close","error"],setup(e,{emit:t}){const a=(0,be.KR)(null),l=(0,be.KR)(null),i=(0,be.KR)(!1),s=(0,be.KR)(0),o=(0,be.KR)(0),n=(0,be.KR)(.05),c=(0,be.KR)(!1),u=(0,be.KR)(!1),d=(0,be.KR)(null),v=(0,be.KR)(!1),g=(0,be.KR)("undefined"!==typeof window?window.innerWidth:1200),h=(0,r.EW)(()=>window.matchMedia("(prefers-color-scheme: dark)").matches),p=(0,r.EW)(()=>e.accentColor||(h.value?"#34d399":"#10b981")),m=(0,r.EW)(()=>{const e=p.value;return`linear-gradient(135deg, ${e}, ${e.replace("1)","9)").replace("399","81")})`}),f=async()=>{if(a.value&&e.track)try{if(!a.value.src||""===a.value.src)return console.error("Êí≠ÊîæÂ§±Ë¥•: Èü≥È¢ëURLÊó†Êïà"),void ElMessage.error("Èü≥È¢ëURLÊó†Êïà");if(i.value=!1,a.value.readyState<2)try{await a.value.load()}catch(t){return console.error("Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•:",t),void ElMessage.error("Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•")}const r=a.value.play();r&&"function"===typeof r.then?(await r,i.value=!0,console.debug("Èü≥È¢ëÊí≠ÊîæÊàêÂäü",{title:e.track.title,url:a.value.src})):i.value=!0}catch(r){console.error("Êí≠ÊîæÊó∂ÂèëÁîüÈîôËØØ:",r),i.value=!1,"NotAllowedError"===r.name||r.message&&r.message.includes("user gesture")?ElMessage.warning("ËØ∑ÁÇπÂáªÊí≠ÊîæÊåâÈíÆ‰ª•ÂºÄÂßãÊí≠ÊîæÈü≥È¢ë"):ElMessage.error("Êí≠ÊîæÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}else console.error("Êí≠ÊîæÂ§±Ë¥•: Áº∫Â∞ëÈü≥È¢ëÂÖÉÁ¥†ÊàñÊõ≤ÁõÆ‰ø°ÊÅØ")},k=()=>{if(a.value)try{console.debug("[MusicPlayer] pause() called"),a.value.pause(),i.value=!1,console.info("[MusicPlayer] paused, isPlaying=",i.value)}catch(e){console.warn("ÊöÇÂÅúÈü≥È¢ëÊó∂ÂèëÁîüË≠¶Âëä:",e)}},y=()=>{i.value?k():f()},b=()=>{if(!a.value||u.value)return;const e=o.value;o.value=a.value.currentTime,Math.abs(o.value-e)>.5&&console.debug("[MusicPlayer] timeupdate ->",o.value.toFixed(2),"/",s)},w=()=>{if(a.value)try{const t=Number(a.value.duration);console.debug("[MusicPlayer] onLoaded: audio.duration=",t),!isNaN(t)&&t>0&&(s.value=t),a.value.volume=n.value,a.value.muted=c.value,e.autoPlay&&setTimeout(()=>f(),300)}catch(t){console.warn("Èü≥È¢ëÂä†ËΩΩÂÆåÊàêÂ§ÑÁêÜÊó∂ÂèëÁîüË≠¶Âëä:",t)}},L=e=>{if(v.value)return;if(!a.value||""===a.value.src)return;console.error("Èü≥È¢ëÈîôËØØ:",e,"Èü≥È¢ëURL:",a.value.src),d.value=e,t("error",{type:"audio_error",event:e,src:a.value.src}),i.value=!1;let r="Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•";if(e&&"error"===e.type)switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:r="Êí≠ÊîæÂ∑≤Ë¢´ÂèñÊ∂à";break;case e.target.error.MEDIA_ERR_NETWORK:r="ÁΩëÁªúÈîôËØØÂØºËá¥Êí≠ÊîæÂ§±Ë¥•";break;case e.target.error.MEDIA_ERR_DECODE:r="Èü≥È¢ëÊ†ºÂºè‰∏çÊîØÊåÅÊàñÂ∑≤ÊçüÂùè";break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:r="Êó†Ê≥ïÂä†ËΩΩÈü≥È¢ëÊñá‰ª∂";break;default:r="Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•ÔºåËØ∑Â∞ùËØïÂÖ∂‰ªñÈü≥‰πê"}ElMessage.error(r)},M=e=>{if(!a.value)return;const t=parseFloat(e.target.value);u.value=!0,o.value=t,console.debug("[MusicPlayer] handleProgressInput newTime=",t,"isSeeking=",u.value)},_=async e=>{if(!a.value)return;const t=parseFloat(e.target.value),l=Math.max(0,Math.min(t,s.value));o.value=l,console.debug("[MusicPlayer] handleProgressChange -> applying time=",l);try{a.value.currentTime=l}catch(n){console.warn("ËÆæÁΩÆÈü≥È¢ëÊó∂Èó¥Êó∂ÂèëÁîüË≠¶Âëä:",n)}if(await(0,r.dY)(),u.value=!1,i.value)try{await a.value.play(),console.debug("[MusicPlayer] resumed play after change")}catch(n){console.error("ÊÅ¢Â§çÊí≠ÊîæÂ§±Ë¥•:",n),i.value=!1}},F=()=>{if(a.value)try{a.value.volume=n.value,n.value>0&&(c.value=!1),a.value.muted=c.value}catch(e){console.warn("ËÆæÁΩÆÈü≥ÈáèÊó∂ÂèëÁîüË≠¶Âëä:",e)}},C=()=>{if(c.value=!c.value,a.value)try{a.value.muted=c.value}catch(e){console.warn("ÂàáÊç¢ÈùôÈü≥Êó∂ÂèëÁîüË≠¶Âëä:",e)}},E=()=>{i.value=!1,o.value=0};(0,r.wB)(()=>e.track,t=>{P();try{if(t&&t.duration){const e=I(t.duration);null!=e&&(s.value=e)}}catch(r){}setTimeout(()=>{if(a.value)try{a.value.volume=n.value,a.value.muted=c.value}catch(r){console.warn("ÂàáÊç¢ËΩ®ÈÅìÊó∂ËÆæÁΩÆÈü≥ÈáèÂíåÈùôÈü≥Áä∂ÊÄÅÂèëÁîüË≠¶Âëä:",r)}e.autoPlay&&t&&f()},100)},{deep:!0}),(0,r.wB)([n,c],()=>{if(a.value)try{a.value.volume=n.value,a.value.muted=c.value}catch(e){console.warn("ÁõëÂê¨Èü≥ÈáèÂèòÂåñÊó∂ÂèëÁîüË≠¶Âëä:",e)}});const P=()=>{o.value=0,s.value=0,i.value=!1,u.value=!1,d.value=null},T=()=>{if(a.value)try{a.value.pause(),a.value.onerror=null,a.value.ontimeupdate=null,a.value.onloadedmetadata=null,a.value.onended=null,a.value.src="",a.value.load()}catch(e){console.warn("Ê∏ÖÁêÜÈü≥È¢ëËµÑÊ∫êÊó∂ÂèëÁîüË≠¶Âëä:",e)}},x=()=>{v.value=!0,k(),T(),P(),setTimeout(()=>{t("close"),v.value=!1},50)};(0,r.xo)(()=>{T();try{window.removeEventListener("resize",R)}catch(e){}});const R=()=>{try{g.value=window.innerWidth}catch(e){}};try{window.addEventListener("resize",R)}catch(U){}const S=(0,r.EW)(()=>{const t=380,a=Math.min(920,Math.floor(.92*g.value)),r=e.track&&e.track.title?String(e.track.title).length:0,l=Math.min(360,8*r),i=420,s=Math.max(t,Math.min(a,i+l));return`${s}px`}),V=e=>{if(!e||isNaN(e))return"00:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`},I=e=>{if(null==e)return null;if("number"===typeof e)return isNaN(e)?null:e;const t=String(e).trim();if(""===t)return null;if(/^\d+(\.\d+)?$/.test(t))return Number(t);const a=t.split(":").map(e=>Number(e));return a.some(e=>isNaN(e))?null:2===a.length?60*a[0]+a[1]:3===a.length?3600*a[0]+60*a[1]+a[2]:null};return{audioEl:a,progressSlider:l,isPlaying:i,duration:s,currentTime:o,volume:n,isMuted:c,isSeeking:u,togglePlay:y,onTimeUpdate:b,onLoaded:w,onEnded:E,handleProgressInput:M,handleProgressChange:_,formatTime:V,setVolume:F,toggleMute:C,isDarkMode:h,handleClose:x,handleAudioError:L,getAccentColor:p,getAccentGradient:m,playerWidth:S}}},Le=a(6262);const Me=(0,Le.A)(we,[["render",ye],["__scopeId","data-v-26877278"]]);var _e=Me,Fe=a(5720),Ce=a(163),Ee=a(9537),Pe=a(9128),Te=a(1857),xe=a(8062),Re={name:"MusicRecommendationView",components:{Headset:B.Headset,VideoPlay:B.VideoPlay,Upload:B.Upload,Loading:B.Loading,Picture:B.Picture,Check:B.Check,MusicPlayer:_e,ElDialog:Pe.kZ,ElButton:Te.S2,ElSelect:xe.AV,ElOption:xe.P9,Microphone:B.Microphone,UploadFilled:B.UploadFilled},data(){return{currentFatigueLevel:this.$route?.query?.fatigue||localStorage.getItem("current_fatigue_level")||"Medium",loading:!1,musicList:[],displayedMusicList:[],currentPage:1,pageSize:12,observer:null,loadMoreObserver:null,isLoadingMore:!1,loadMoreTrigger:null,selectedTrack:null,showPlayer:!1,autoPlay:function(){try{const e=JSON.parse(localStorage.getItem("user")||"null");return"true"===e?.preferences?.auto_play}catch(e){return!1}}(),showAddDialog:!1,newMusic:{title:"",artist:"",duration:"",cover:"",reason:"",music_type:"natural",fatigue_level:"medium",match_rate:50,audio_url:""},selectedFile:null,selectedFileName:"",uploading:!1,uploadProgress:0,selectedCoverFile:null,selectedCoverFileName:"",uploadingCover:!1,coverUploadProgress:0}},computed:{totalPages(){return Math.ceil(this.musicList.length/this.pageSize)},hasMoreMusic(){return this.currentPage<this.totalPages&&!this.loading},fatigueTagType(){const e=this.currentFatigueLevel.toLowerCase();return e.includes("light")||e.includes("‰Ωé")?"info":e.includes("medium")||e.includes("‰∏≠")?"warning":e.includes("heavy")||e.includes("È´ò")||e.includes("Èáç")?"danger":"info"}},methods:{resolveMediaUrl(e){try{return(0,Ee.V)(e)}catch(t){return e}},updateDisplayedMusicList(){const e=Array.isArray(this.musicList)?this.musicList:[],t=e.map(e=>({...e,id:e.id||`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:e.title||"Êú™Áü•Ê≠åÊõ≤",artist:e.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂",duration:e.duration||"00:00",match_rate:e.match_rate||0,reason:e.reason||"ÊöÇÊó†Êé®ËçêÁêÜÁî±",cover:(0,Ee.V)(e.cover||e.cover_url||"/static/music_cover/placeholder.png")})),a=(this.currentPage-1)*this.pageSize,r=a+this.pageSize;this.displayedMusicList=t.slice(a,r),console.log("[MusicRecommendation] ÊòæÁ§∫ÁöÑÈü≥‰πêÊï∞Èáè:",this.displayedMusicList.length),this.$nextTick(()=>{this.handleScroll()})},loadMoreMusic(){this.currentPage<this.totalPages&&!this.isLoadingMore&&(this.isLoadingMore=!0,this.currentPage++,this.updateDisplayedMusicList(),this.$nextTick(()=>{this.isLoadingMore=!1}))},refreshCurrentPage(){this.currentPage=1,this.updateDisplayedMusicList()},getCoverUrl(e){if(!e)return(0,Ee.V)("/static/music_cover/placeholder.png");const t=e.cover||e.cover_url;return t?(0,Ee.V)(t):(0,Ee.V)("/static/music_cover/placeholder.png")},observeMusicCard(e){if(e&&!e.dataset.observed){e.dataset.observed="true",e.style.opacity="1",e.style.transform="translateY(0)";try{const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("animate-in")},10),t.unobserve(e.target))})},{rootMargin:"100px 0px",threshold:.05});t.observe(e)}catch(t){console.warn("Âç°ÁâáËßÇÂØüÂô®ÂàùÂßãÂåñÂ§±Ë¥•:",t)}}},openAddDialog(){const e=e=>{if(!e)return"medium";const t=String(e).trim().toLowerCase();return"high"===t?"heavy":"low"===t?"light":"heavy"===t||"light"===t||"medium"===t?t:"high"===t||"low"===t?"high"===t?"heavy":"light":"medium"};try{this.newMusic.fatigue_level=e(this.currentFatigueLevel)}catch(t){}this.showAddDialog=!0},handleImageError(e,t){const a=e.target;a.src=(0,Ee.V)("/static/music_cover/placeholder.png"),t&&(t.cover=(0,Ee.V)("/static/music_cover/placeholder.png"))},handleScroll(){"IntersectionObserver"in window&&!this.observer?(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate-in"),this.observer.unobserve(e.target))})},{rootMargin:"100px 0px",threshold:.1}),document.querySelectorAll(".music-card:not(.animate-in)").forEach(e=>{this.observer.observe(e)})):window.requestAnimationFrame(()=>{const e=document.querySelectorAll(".music-card:not(.animate-in)");Array.from(e).slice(0,10).forEach(e=>{const t=e.getBoundingClientRect(),a=t.top<window.innerHeight+100;a&&e.classList.add("animate-in")})})},async loadMusic(){this.loading=!0;try{let t=null;const a=(this.currentFatigueLevel||"Medium").toLowerCase(),r=[{id:1,title:"ËΩªÊüîÈí¢Áê¥Êõ≤",artist:"Êú™Áü•Ëâ∫ÊúØÂÆ∂",duration:"02:34",match_rate:95,reason:"ËàíÁºìÁöÑÈí¢Áê¥Êõ≤ÊúâÂä©‰∫éÁºìËß£ËΩªÂ∫¶Áñ≤Âä≥",cover:(0,Ee.V)("/static/music_cover/placeholder.png")},{id:2,title:"Ëá™ÁÑ∂Èõ®Â£∞",artist:"ÁéØÂ¢ÉÈü≥‰πê",duration:"05:12",match_rate:88,reason:"Ëá™ÁÑ∂Èü≥ÊïàËÉΩÂ§üÂ∏ÆÂä©ÊîæÊùæÂøÉÊÉÖ",cover:(0,Ee.V)("/static/music_cover/placeholder.png")},{id:3,title:"ÂÜ•ÊÉ≥Èü≥‰πê",artist:"ÂÜ•ÊÉ≥Â§ßÂ∏à",duration:"10:00",match_rate:92,reason:"ÈÄÇÂêàÊ∑±Â∫¶ÊîæÊùæÔºåÁºìËß£Â∑•‰ΩúÂéãÂäõ",cover:(0,Ee.V)("/static/music_cover/placeholder.png")}];try{t=await Fe.f.get("/music/recommend",{fatigue_level:a}),t&&t.data&&t.data.music_list&&t.data.music_list.length>0?(this.musicList=t.data.music_list,console.log("[MusicRecommendation] ÊàêÂäüÂä†ËΩΩÊé®ËçêÈü≥‰πê:",this.musicList.length)):(console.log("Êé®ËçêÊé•Âè£ËøîÂõûÁ©∫Êï∞ÊçÆÔºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ"),this.musicList=r)}catch(e){console.log("Êé®ËçêÊé•Âè£Ë∞ÉÁî®Â§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆËøõË°åÊµãËØï",e),this.musicList=r}this.currentPage=1,this.updateDisplayedMusicList()}catch(e){console.error("Âä†ËΩΩÈü≥‰πêÂ§±Ë¥•",e),Ce.nk.error("Âä†ËΩΩÈü≥‰πêÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}finally{this.loading=!1}},playTrack(e){if(console.debug("[MusicRecommendation] playTrack called, music=",e),!e)return console.error("[MusicRecommendation] Invalid music parameter:",e),void Ce.nk.error("Êí≠ÊîæÂ§±Ë¥•ÔºöÈü≥‰πê‰ø°ÊÅØÊó†Êïà");const t={...e};try{!t.src&&t.audio_url?t.src=(0,Ee.V)(t.audio_url):t.src||(t.src=(0,Ee.V)(`/static/music/sample${t.id||1}.mp3`));const e=t.cover||t.cover_url;t.cover=e?(0,Ee.V)(e):(0,Ee.V)("/static/music_cover/placeholder.png");const a=e=>{if(null==e)return null;if("number"===typeof e)return e;if(/^\d+$/.test(String(e)))return Number(e);const t=String(e).split(":").map(e=>Number(e));return 2!==t.length||isNaN(t[0])||isNaN(t[1])?3===t.length&&t.every(e=>!isNaN(e))?3600*t[0]+60*t[1]+t[2]:null:60*t[0]+t[1]},r=a(t.duration);t.duration=null!=r?r:0,console.debug("[MusicRecommendation] Processed track:",{id:t.id,title:t.title,src:t.src,duration:t.duration})}catch(a){return console.error("[MusicRecommendation] Error processing track:",a),void Ce.nk.error("Êí≠ÊîæÂ§±Ë¥•ÔºöÈü≥‰πêÊï∞ÊçÆÂ§ÑÁêÜÈîôËØØ")}this.selectedTrack=t,this.showPlayer=!0},async addMusic(){try{if(!this.newMusic.title)return void Ce.nk.warning("ËØ∑Â°´ÂÜôÈü≥‰πêÊ†áÈ¢ò");const e={...this.newMusic};e.audio_url&&(e.src=e.audio_url,delete e.audio_url);const t=await Fe.f.post("/music",e);if(t&&200===t.code){Ce.nk.success("Ê∑ªÂä†ÊàêÂäü"),this.showAddDialog=!1;const e=e=>{if(!e)return"medium";const t=String(e).trim().toLowerCase();return"high"===t?"heavy":"low"===t?"light":["heavy","light","medium"].includes(t)?t:"medium"};this.newMusic={title:"",artist:"",duration:"",cover:"",reason:"",music_type:"natural",fatigue_level:e(this.currentFatigueLevel),match_rate:50,audio_url:""},await this.loadMusic()}else Ce.nk.error(t?.msg||"Ê∑ªÂä†Â§±Ë¥•")}catch(e){console.error("Ê∑ªÂä†Èü≥‰πêÂ§±Ë¥•",e),Ce.nk.error("Ê∑ªÂä†Èü≥‰πêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÂèÇÊï∞")}},onFileChange(e){const t=e.target.files&&e.target.files[0];if(!t)return;this.selectedFile=t,this.selectedFileName=t.name;const a=t.name.replace(/\.[^/.]+$/,"");this.newMusic.title=a.replace(/[_-]+/g," "),this.newMusic.duration="",this.computeDurationFromFile(t).then(e=>{e&&(this.newMusic.duration=e)}).catch(()=>{})},computeDurationFromFile(e){return new Promise(t=>{try{const a=URL.createObjectURL(e),r=new Audio;r.src=a,r.addEventListener("loadedmetadata",()=>{const e=Math.floor(r.duration||0);URL.revokeObjectURL(a);const l=String(Math.floor(e/60)).padStart(2,"0"),i=String(e%60).padStart(2,"0");t(`${l}:${i}`)}),r.addEventListener("error",()=>{URL.revokeObjectURL(a),t(null)})}catch(a){t(null)}})},async uploadFile(){if(this.selectedFile)try{this.uploading=!0,this.uploadProgress=0;const e=new FormData;e.append("file",this.selectedFile);const t=await Fe.A.post("/music/upload",e,{onUploadProgress:e=>{e.total&&(this.uploadProgress=Math.round(100*e.loaded/e.total))},timeout:3e4});if(t&&200===t.code&&t.data&&t.data.src){const e=t.data;this.newMusic.audio_url=e.src,this.newMusic.src=e.src,e.title&&(this.newMusic.title=e.title),e.artist&&(this.newMusic.artist=e.artist),e.duration&&(this.newMusic.duration=e.duration),e.cover&&(this.newMusic.cover=e.cover),Ce.nk.success("‰∏ä‰º†ÊàêÂäüÔºåÂ∑≤Â°´ÂÖÖÈü≥È¢ë‰ø°ÊÅØ")}else Ce.nk.error(t?.msg||"‰∏ä‰º†Â§±Ë¥•")}catch(e){console.error("‰∏ä‰º†Â§±Ë¥•",e),Ce.nk.error("‰∏ä‰º†Â§±Ë¥•")}finally{this.uploading=!1;try{this.$refs.fileInput.value=null}catch(e){}this.uploadProgress=0}else Ce.nk.warning("ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂")},onCoverChange(e){const t=e.target.files&&e.target.files[0];t&&(this.selectedCoverFile=t,this.selectedCoverFileName=t.name)},async uploadCover(){if(this.selectedCoverFile)try{this.uploadingCover=!0,this.coverUploadProgress=0;const e=new FormData;e.append("file",this.selectedCoverFile);const t=await Fe.A.post("/music/upload_cover",e,{onUploadProgress:e=>{e.total&&(this.coverUploadProgress=Math.round(100*e.loaded/e.total))}});t&&200===t.code&&t.data&&t.data.cover?(this.newMusic.cover=t.data.cover,Ce.nk.success("Â∞ÅÈù¢‰∏ä‰º†ÊàêÂäü")):Ce.nk.error(t?.msg||"Â∞ÅÈù¢‰∏ä‰º†Â§±Ë¥•")}catch(e){console.error("Â∞ÅÈù¢‰∏ä‰º†Â§±Ë¥•",e),Ce.nk.error("‰∏ä‰º†Â∞ÅÈù¢Â§±Ë¥•")}finally{this.uploadingCover=!1;try{this.$refs.coverInput.value=null}catch(e){}this.coverUploadProgress=0}else Ce.nk.warning("ËØ∑ÂÖàÈÄâÊã©Â∞ÅÈù¢Êñá‰ª∂")},async deleteMusic(e){try{await Fe.f.delete(`/music/${e}`,{delete_files:!0}),Ce.nk.success("Âà†Èô§ÊàêÂäü"),this.musicList=this.musicList.filter(t=>t.id!==e),this.updateDisplayedMusicList()}catch(t){console.error("Âà†Èô§Èü≥‰πêÂ§±Ë¥•",t),Ce.nk.error("Âà†Èô§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}}},mounted(){const e=this.$route?.query?.fatigue;if(e){try{localStorage.setItem("current_fatigue_level",e)}catch(a){}this.currentFatigueLevel=e}else this.currentFatigueLevel=localStorage.getItem("current_fatigue_level")||this.currentFatigueLevel;this.loadMusic(),this.$nextTick(()=>{"IntersectionObserver"in window&&(this.loadMoreObserver=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.hasMoreMusic&&!this.isLoadingMore&&this.loadMoreMusic()})},{rootMargin:"100px 0px",threshold:.1}),this.$refs.loadMoreTrigger&&this.loadMoreObserver.observe(this.$refs.loadMoreTrigger))});let t=null;window.addEventListener("scroll",()=>{t||(t=setTimeout(()=>{this.handleScroll(),window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&this.loadMoreMusic(),t=null},100))})},beforeUnmount(){this.observer&&this.observer.disconnect(),this.loadMoreObserver&&this.loadMoreObserver.disconnect(),window.removeEventListener("scroll",this.handleScroll)}};const Se=(0,Le.A)(Re,[["render",j],["__scopeId","data-v-22b8b3cc"]]);var Ve=Se},3579:function(e,t,a){var r=a(6518),l=a(9565),i=a(2652),s=a(9306),o=a(8551),n=a(1767),c=a(9539),u=a(4549),d=u("some",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:d},{some:function(e){o(this);try{s(e)}catch(r){c(this,"throw",r)}if(d)return l(d,this,e);var t=n(this),a=0;return i(t,function(t,r){if(e(t,a++))return r()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},4209:function(e,t,a){var r=a(8227),l=a(6269),i=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(l.Array===e||s[i]===e)}},4603:function(e,t,a){var r=a(6840),l=a(9504),i=a(655),s=a(2812),o=URLSearchParams,n=o.prototype,c=l(n.append),u=l(n["delete"]),d=l(n.forEach),v=l([].push),g=new o("a=1&a=2&b=3");g["delete"]("a",1),g["delete"]("b",void 0),g+""!=="a=2"&&r(n,"delete",function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return u(this,e);var r=[];d(this,function(e,t){v(r,{key:t,value:e})}),s(t,1);var l,o=i(e),n=i(a),g=0,h=0,p=!1,m=r.length;while(g<m)l=r[g++],p||l.key===o?(p=!0,u(this,l.key)):h++;while(h<m)l=r[h++],l.key===o&&l.value===n||c(this,l.key,l.value)},{enumerable:!0,unsafe:!0})},6080:function(e,t,a){var r=a(7476),l=a(9306),i=a(616),s=r(r.bind);e.exports=function(e,t){return l(e),void 0===t?e:i?s(e,t):function(){return e.apply(t,arguments)}}},6269:function(e){e.exports={}},6955:function(e,t,a){var r=a(2140),l=a(4901),i=a(2195),s=a(8227),o=s("toStringTag"),n=Object,c="Arguments"===i(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(a){}};e.exports=r?i:function(e){var t,a,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(a=u(t=n(e),o))?a:c?i(t):"Object"===(r=i(t))&&l(t.callee)?"Arguments":r}},7476:function(e,t,a){var r=a(2195),l=a(9504);e.exports=function(e){if("Function"===r(e))return l(e)}},7566:function(e,t,a){var r=a(6840),l=a(9504),i=a(655),s=a(2812),o=URLSearchParams,n=o.prototype,c=l(n.getAll),u=l(n.has),d=new o("a=1");!d.has("a",2)&&d.has("a",void 0)||r(n,"has",function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return u(this,e);var r=c(this,e);s(t,1);var l=i(a),o=0;while(o<r.length)if(r[o++]===l)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:function(e,t,a){var r=a(6518),l=a(9565),i=a(2652),s=a(9306),o=a(8551),n=a(1767),c=a(9539),u=a(4549),d=u("forEach",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:d},{forEach:function(e){o(this);try{s(e)}catch(r){c(this,"throw",r)}if(d)return l(d,this,e);var t=n(this),a=0;i(t,function(t){e(t,a++)},{IS_RECORD:!0})}})},8721:function(e,t,a){var r=a(3724),l=a(9504),i=a(2106),s=URLSearchParams.prototype,o=l(s.forEach);r&&!("size"in s)&&i(s,"size",{get:function(){var e=0;return o(this,function(){e++}),e},configurable:!0,enumerable:!0})},9537:function(e,t,a){function r(e){if(!e)return e;try{const a=String(e);if(a.startsWith("http"))return a;const r=a.startsWith("/")?a:`/${a}`;try{const e=window.process?.env||{};let t=e.VUE_APP_API_BASE_URL||null;return t||(t=window.location.origin),t=String(t).replace(/\/$/,""),t=t.replace(/\/api$/,""),t+r}catch(t){return r}}catch(t){return e}}a.d(t,{V:function(){return r}})}}]);
//# sourceMappingURL=music.7d00b134.js.map