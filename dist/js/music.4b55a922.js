"use strict";(self["webpackChunkwavetune"]=self["webpackChunkwavetune"]||[]).push([[692],{9422:function(e,t,a){a.r(t),a.d(t,{default:function(){return Se}});a(4114);var l=a(6768),s=a(4232),r=a(5130);const i={class:"music-recommendation-view"},o={class:"recommendation-header"},n={class:"header-content"},c={class:"header-text"},u={class:"main-text"},d={class:"recommendation-basis"},v={style:{display:"flex","align-items":"center",gap:"12px"}},g={class:"music-grid"},m={key:0,class:"skeleton-grid"},p={class:"cover-section"},h={class:"image-error"},k={class:"match-badge"},y=["onClick","aria-label"],f={class:"info-section"},b={class:"music-title"},L={class:"music-artist"},M={class:"music-meta"},w={class:"music-duration"},_={class:"music-reason"},F={key:0,class:"empty-state"},C={class:"empty-container"},P={key:1,ref:"loadMoreTrigger",class:"load-more-trigger"},E={key:2,class:"all-loaded"},x={key:3,class:"load-more-section"},T={class:"dialog-content"},R={class:"left-section"},S={class:"cover-wrapper"},V={class:"cover-container"},U={class:"cover-placeholder"},W={class:"audio-upload"},I={class:"upload-btn-group"},A={key:0,class:"progress-container"},$={class:"progress-text"},N={class:"file-info"},D={class:"file-name"},X={class:"right-section"},O={class:"cover-setting"},z={class:"cover-btn-group"},K={key:0,class:"cover-file-info"},Q={class:"dialog-footer",style:{display:"flex","justify-content":"flex-end",gap:"12px"}};function H(e,t,a,H,B,q){const j=(0,l.g2)("el-tag"),G=(0,l.g2)("Upload"),Y=(0,l.g2)("el-icon"),J=(0,l.g2)("el-button"),Z=(0,l.g2)("el-col"),ee=(0,l.g2)("el-row"),te=(0,l.g2)("Headset"),ae=(0,l.g2)("el-image"),le=(0,l.g2)("VideoPlay"),se=(0,l.g2)("el-skeleton-item"),re=(0,l.g2)("el-skeleton"),ie=(0,l.g2)("MusicPlayer"),oe=(0,l.g2)("Microphone"),ne=(0,l.g2)("UploadFilled"),ce=(0,l.g2)("Loading"),ue=(0,l.g2)("el-progress"),de=(0,l.g2)("el-input"),ve=(0,l.g2)("el-form-item"),ge=(0,l.g2)("el-option"),me=(0,l.g2)("el-select"),pe=(0,l.g2)("Picture"),he=(0,l.g2)("el-form"),ke=(0,l.g2)("Check"),ye=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",i,[t[26]||(t[26]=(0,l.Lk)("div",{class:"wave-bg-container"},[(0,l.Lk)("div",{class:"wave-bg wave-bg-1"}),(0,l.Lk)("div",{class:"wave-bg wave-bg-2"}),(0,l.Lk)("div",{class:"wave-bg wave-bg-3"})],-1)),(0,l.Lk)("div",o,[(0,l.Lk)("div",n,[(0,l.Lk)("div",c,[(0,l.Lk)("h2",u,[t[16]||(t[16]=(0,l.eW)(" ‰∏∫ÊÇ®Êé®ËçêÈÄÇÂêàÂΩìÂâçÁä∂ÊÄÅÁöÑËΩªÈü≥‰πê ",-1)),(0,l.Lk)("span",d,"ÔºàÂü∫‰∫é "+(0,s.v_)(B.currentFatigueLevel)+" Áñ≤Âä≥Á≠âÁ∫ßÔºâ",1)]),t[17]||(t[17]=(0,l.Lk)("p",{class:"sub-text"},"ÁÇπÂáªÂç°ÁâáÂèØÊü•ÁúãËØ¶ÊÉÖ",-1))]),(0,l.Lk)("div",v,[(0,l.bF)(j,{class:"fatigue-tag",type:q.fatigueTagType,size:"large"},{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(B.currentFatigueLevel)+" Áñ≤Âä≥‰∏ìÂ±û",1)]),_:1},8,["type"]),(0,l.bF)(J,{type:"primary",plain:"",size:"small",onClick:q.openAddDialog,class:"add-music-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(G)]),_:1}),t[18]||(t[18]=(0,l.eW)("Ê∑ªÂä†Èü≥‰πê ",-1))]),_:1},8,["onClick"])])])]),(0,l.Lk)("div",g,[B.loading?((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)(ee,{gutter:16},{default:(0,l.k6)(()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(6,e=>(0,l.bF)(Z,{key:e,xs:24,sm:12,md:8,lg:6,xl:6},{default:(0,l.k6)(()=>[...t[19]||(t[19]=[(0,l.Lk)("div",{class:"music-card skeleton"},[(0,l.Lk)("div",{class:"cover-section"},[(0,l.Lk)("div",{class:"skeleton-cover"})]),(0,l.Lk)("div",{class:"info-section"},[(0,l.Lk)("div",{class:"skeleton-line short"}),(0,l.Lk)("div",{class:"skeleton-line"})])],-1)])]),_:1})),64))]),_:1})])):(0,l.Q3)("",!0),B.displayedMusicList.length>0?((0,l.uX)(),(0,l.Wv)(ee,{key:1,gutter:16},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(B.displayedMusicList,e=>((0,l.uX)(),(0,l.Wv)(Z,{key:`${e.id||Math.random()}`,xs:24,sm:12,md:8,lg:6,xl:6,class:"music-col"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",{class:"music-card business-card",ref_for:!0,ref:e=>e&&q.observeMusicCard(e)},[(0,l.Lk)("div",p,[(0,l.bF)(ae,{src:q.getCoverUrl(e),alt:`${e.title||"Êú™Áü•Ê≠åÊõ≤"} - ${e.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂"}`,class:"music-cover",fit:"cover",lazy:!1,onError:t=>q.handleImageError(t,e),onLoad:t[0]||(t[0]=e=>e.target.classList.add("is-loaded"))},{error:(0,l.k6)(()=>[(0,l.Lk)("div",h,[(0,l.bF)(te,{class:"music-icon"})])]),_:1},8,["src","alt","onError"]),(0,l.Lk)("div",k,(0,s.v_)(e.match_rate)+"% ÂåπÈÖç ",1),(0,l.Lk)("button",{class:"play-button",type:"button",onClick:(0,r.D$)(t=>q.playTrack(e),["stop"]),"aria-label":"Êí≠Êîæ "+(e.title||"Ê≠åÊõ≤")},[(0,l.bF)(le,{class:"play-svg-icon"})],8,y),(0,l.bF)(J,{class:"delete-music-btn",type:"danger",size:"small",onClick:(0,r.D$)(t=>q.deleteMusic(e.id),["stop"])},{default:(0,l.k6)(()=>[...t[20]||(t[20]=[(0,l.eW)("Âà†Èô§",-1)])]),_:1},8,["onClick"])]),(0,l.Lk)("div",f,[(0,l.Lk)("h3",b,(0,s.v_)(e.title),1),(0,l.Lk)("p",L,(0,s.v_)(e.artist),1),(0,l.Lk)("div",M,[(0,l.Lk)("span",w,(0,s.v_)(e.duration),1)]),(0,l.Lk)("p",_,(0,s.v_)(e.reason),1)])],512)]),_:2},1024))),128))]),_:1})):(0,l.Q3)("",!0)]),0!==B.musicList.length||B.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",F,[(0,l.Lk)("div",C,[(0,l.bF)(te,{class:"empty-icon"}),t[22]||(t[22]=(0,l.Lk)("p",{class:"empty-text"},"ÊöÇÊó†Êé®ËçêÈü≥‰πê",-1)),t[23]||(t[23]=(0,l.Lk)("p",{class:"empty-subtext"},"ËØ∑ÂÖàÂÆåÊàêËÑëÁñ≤Âä≥Ê£ÄÊµã‰ª•Ëé∑Âæó‰∏™ÊÄßÂåñÊé®Ëçê",-1)),(0,l.bF)(J,{type:"primary",onClick:t[1]||(t[1]=t=>e.$router.push("/signal-monitor")),class:"primary-button"},{default:(0,l.k6)(()=>[...t[21]||(t[21]=[(0,l.eW)(" ÂâçÂæÄÊ£ÄÊµã ",-1)])]),_:1})])])),q.hasMoreMusic?((0,l.uX)(),(0,l.CE)("div",P,[(0,l.bF)(re,{loading:B.isLoadingMore,animated:""},{default:(0,l.k6)(()=>[(0,l.bF)(se,{variant:"text",style:{width:"30%","margin-bottom":"15px"}})]),_:1},8,["loading"])],512)):B.displayedMusicList.length>0?((0,l.uX)(),(0,l.CE)("div",E,[...t[24]||(t[24]=[(0,l.Lk)("p",null,"Â∑≤ÊòæÁ§∫ÂÖ®ÈÉ®Êé®ËçêÈü≥‰πê",-1)])])):(0,l.Q3)("",!0),B.currentPage<q.totalPages&&!B.loading?((0,l.uX)(),(0,l.CE)("div",x,[(0,l.bF)(J,{type:"primary",plain:"",onClick:q.loadMoreMusic,class:"load-more-btn"},{default:(0,l.k6)(()=>[...t[25]||(t[25]=[(0,l.eW)(" Âä†ËΩΩÊõ¥Â§ö ",-1)])]),_:1},8,["onClick"])])):(0,l.Q3)("",!0)]),B.showPlayer?((0,l.uX)(),(0,l.Wv)(ie,{key:0,track:B.selectedTrack,autoPlay:B.autoPlay,onClose:t[2]||(t[2]=e=>B.showPlayer=!1)},null,8,["track","autoPlay"])):(0,l.Q3)("",!0),(0,l.bF)(ye,{title:"Ê∑ªÂä†Èü≥‰πê",modelValue:B.showAddDialog,"onUpdate:modelValue":t[15]||(t[15]=e=>B.showAddDialog=e),width:"600px","append-to-body":"",class:"custom-add-music-dialog",style:{"z-index":"10000"}},{footer:(0,l.k6)(()=>[(0,l.Lk)("div",Q,[(0,l.bF)(J,{class:"cancel-button",onClick:t[14]||(t[14]=e=>B.showAddDialog=!1)},{default:(0,l.k6)(()=>[...t[36]||(t[36]=[(0,l.eW)("ÂèñÊ∂à",-1)])]),_:1}),(0,l.bF)(J,{type:"primary",disabled:B.uploading,onClick:q.addMusic,style:{"margin-left":"12px"}},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(ke)]),_:1}),t[37]||(t[37]=(0,l.eW)("Ê∑ªÂä†Èü≥‰πê ",-1))]),_:1},8,["disabled","onClick"])])]),default:(0,l.k6)(()=>[(0,l.bF)(he,{"label-width":"80px",class:"music-form"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",T,[(0,l.Lk)("div",R,[(0,l.Lk)("div",S,[(0,l.Lk)("div",V,[(0,l.bF)(ae,{src:B.newMusic.cover||"/static/music_cover/1.png",fit:"cover",class:"cover-image"},{error:(0,l.k6)(()=>[(0,l.Lk)("div",U,[(0,l.bF)(te,{class:"placeholder-icon"}),t[27]||(t[27]=(0,l.Lk)("span",{class:"placeholder-text"},"Â∞ÅÈù¢È¢ÑËßà",-1))])]),_:1},8,["src"]),t[28]||(t[28]=(0,l.Lk)("div",{class:"cover-ring"},null,-1))])]),(0,l.Lk)("div",W,[t[30]||(t[30]=(0,l.Lk)("h4",{class:"upload-title"},"Èü≥È¢ë‰∏ä‰º†",-1)),(0,l.Lk)("div",I,[(0,l.Lk)("input",{type:"file",accept:"audio/*",ref:"fileInput",onChange:t[3]||(t[3]=(...e)=>q.onFileChange&&q.onFileChange(...e)),class:"hidden-input"},null,544),(0,l.bF)(J,{size:"small",class:"select-audio-btn",onClick:t[4]||(t[4]=t=>e.$refs.fileInput.click())},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(oe)]),_:1}),t[29]||(t[29]=(0,l.eW)("ÈÄâÊã©Èü≥È¢ë ",-1))]),_:1}),(0,l.bF)(J,{size:"small",type:"primary",loading:B.uploading,onClick:q.uploadFile,disabled:!B.selectedFile},{default:(0,l.k6)(()=>[B.uploading?((0,l.uX)(),(0,l.Wv)(Y,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(ce)]),_:1})):((0,l.uX)(),(0,l.Wv)(Y,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(ne)]),_:1})),(0,l.eW)(" "+(0,s.v_)(B.uploading?"‰∏ä‰º†‰∏≠":"‰∏ä‰º†"),1)]),_:1},8,["loading","onClick","disabled"])]),B.uploading?((0,l.uX)(),(0,l.CE)("div",A,[(0,l.bF)(ue,{percentage:B.uploadProgress,"stroke-width":"2",class:"progress-bar"},null,8,["percentage"]),(0,l.Lk)("span",$,(0,s.v_)(B.uploadProgress)+"%",1)])):(0,l.Q3)("",!0),(0,l.Lk)("div",N,[(0,l.Lk)("span",D,(0,s.v_)(B.selectedFileName||"Êú™ÈÄâÊã©Êñá‰ª∂"),1)]),t[31]||(t[31]=(0,l.Lk)("p",{class:"upload-hint"},"ÊîØÊåÅ MP3„ÄÅWAV Ê†ºÂºèÔºåÊñá‰ª∂Â§ßÂ∞è‰∏çË∂ÖËøá 50MB",-1))])]),(0,l.Lk)("div",X,[(0,l.bF)(ve,{label:"Ê†áÈ¢ò",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.bF)(de,{modelValue:B.newMusic.title,"onUpdate:modelValue":t[5]||(t[5]=e=>B.newMusic.title=e),placeholder:"ËØ∑ËæìÂÖ•Èü≥‰πêÊ†áÈ¢ò",class:"form-control"},null,8,["modelValue"])]),_:1}),(0,l.bF)(ve,{label:"Ëâ∫ÊúØÂÆ∂",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.bF)(de,{modelValue:B.newMusic.artist,"onUpdate:modelValue":t[6]||(t[6]=e=>B.newMusic.artist=e),placeholder:"ËØ∑ËæìÂÖ•Ëâ∫ÊúØÂÆ∂/Âàõ‰ΩúËÄÖ",class:"form-control"},null,8,["modelValue"])]),_:1}),(0,l.bF)(ve,{label:"Êó∂Èïø",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.bF)(de,{modelValue:B.newMusic.duration,"onUpdate:modelValue":t[7]||(t[7]=e=>B.newMusic.duration=e),placeholder:"Ê†ºÂºè 05:30",class:"form-control"},null,8,["modelValue"]),t[32]||(t[32]=(0,l.Lk)("p",{class:"form-hint"},"Ëã•Êú™Â°´ÂÜôÔºå‰∏ä‰º†ÂêéÂ∞ÜËá™Âä®Ëé∑Âèñ",-1))]),_:1}),(0,l.bF)(ve,{label:"Èü≥‰πêÁ±ªÂûã",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.bF)(me,{modelValue:B.newMusic.music_type,"onUpdate:modelValue":t[8]||(t[8]=e=>B.newMusic.music_type=e),placeholder:"ÈÄâÊã©Èü≥‰πêÁ±ªÂûã",style:{width:"180px"}},{default:(0,l.k6)(()=>[(0,l.bF)(ge,{label:"Ëá™ÁÑ∂ / Natural",value:"natural"}),(0,l.bF)(ge,{label:"Èí¢Áê¥ / Piano",value:"piano"}),(0,l.bF)(ge,{label:"ÁôΩÂô™Èü≥ / WhiteNoise",value:"whitenoise"}),(0,l.bF)(ge,{label:"Ê∑∑Âêà / Mix",value:"mix"})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(ve,{label:"ÈÄÇÁî®Áñ≤Âä≥Á®ãÂ∫¶",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.bF)(me,{modelValue:B.newMusic.fatigue_level,"onUpdate:modelValue":t[9]||(t[9]=e=>B.newMusic.fatigue_level=e),placeholder:"ÈÄâÊã©ÈÄÇÁî®Áñ≤Âä≥Á®ãÂ∫¶",style:{width:"180px"}},{default:(0,l.k6)(()=>[(0,l.bF)(ge,{label:"ËΩªÂ∫¶ÔºàLightÔºâ",value:"light"}),(0,l.bF)(ge,{label:"‰∏≠Â∫¶ÔºàMediumÔºâ",value:"medium"}),(0,l.bF)(ge,{label:"ÈáçÂ∫¶ÔºàHeavyÔºâ",value:"heavy"})]),_:1},8,["modelValue"]),t[33]||(t[33]=(0,l.Lk)("p",{class:"form-hint"},"ËØ∑ÈÄâÊã©ËøôÈ¶ñÊ≠åÈÄÇÂêàÁöÑÁñ≤Âä≥Á≠âÁ∫ßÔºàÁïåÈù¢ÊòæÁ§∫‰∏∫‰∏≠ÊñáÔºâ",-1))]),_:1}),(0,l.bF)(ve,{label:"Â∞ÅÈù¢ËÆæÁΩÆ",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",O,[(0,l.bF)(de,{modelValue:B.newMusic.cover,"onUpdate:modelValue":t[10]||(t[10]=e=>B.newMusic.cover=e),placeholder:"Â∞ÅÈù¢ÂõæÁâá URLÔºàÂèØÈÄâÔºâ",class:"cover-url-input",style:{"margin-bottom":"8px"}},null,8,["modelValue"]),(0,l.Lk)("div",z,[(0,l.Lk)("input",{type:"file",accept:"image/*",ref:"coverInput",onChange:t[11]||(t[11]=(...e)=>q.onCoverChange&&q.onCoverChange(...e)),class:"hidden-input"},null,544),(0,l.bF)(J,{size:"small",class:"select-cover-btn",onClick:t[12]||(t[12]=t=>e.$refs.coverInput.click())},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(pe)]),_:1}),t[34]||(t[34]=(0,l.eW)("ÈÄâÊã©ÂõæÁâá ",-1))]),_:1}),(0,l.bF)(J,{size:"small",type:"primary",loading:B.uploadingCover,onClick:q.uploadCover,disabled:!B.selectedCoverFile},{default:(0,l.k6)(()=>[B.uploadingCover?((0,l.uX)(),(0,l.Wv)(Y,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(ce)]),_:1})):((0,l.uX)(),(0,l.Wv)(Y,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(ne)]),_:1})),t[35]||(t[35]=(0,l.eW)(" ‰∏ä‰º†Â∞ÅÈù¢ ",-1))]),_:1},8,["loading","onClick","disabled"])])]),B.selectedCoverFileName?((0,l.uX)(),(0,l.CE)("div",K,"Â∑≤ÈÄâÂ∞ÅÈù¢Ôºö"+(0,s.v_)(B.selectedCoverFileName),1)):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)(ve,{label:"Êé®ËçêÁêÜÁî±",class:"form-item"},{default:(0,l.k6)(()=>[(0,l.bF)(de,{type:"textarea",modelValue:B.newMusic.reason,"onUpdate:modelValue":t[13]||(t[13]=e=>B.newMusic.reason=e),placeholder:`ËØ¥Êòé‰∏∫‰ªÄ‰πàËøôÈ¶ñÊ≠åÈÄÇÂêà${B.currentFatigueLevel}Áñ≤Âä≥Áä∂ÊÄÅ...`,rows:"4",class:"form-control form-textarea"},null,8,["modelValue","placeholder"])]),_:1})])])]),_:1})]),_:1},8,["modelValue"])],64)}a(8111),a(1148),a(2489),a(7588),a(1701),a(4603),a(7566),a(8721);var B=a(7477);const q={class:"player-main"},j={class:"record-container"},G={class:"record"},Y=["src"],J={class:"meta-controls"},Z={class:"meta"},ee=["title"],te=["data-text"],ae=["title"],le=["title"],se={class:"progress-container"},re={class:"progress-bar-wrapper"},ie=["max","value"],oe={class:"time-display"},ne={class:"current-time"},ce={class:"total-time"},ue={class:"controls"},de=["aria-label"],ve={class:"volume-controls"},ge=["aria-pressed","title"],me={key:0},pe={key:1},he={key:2},ke={key:3},ye=["src"];function fe(e,t,a,i,o,n){const c=(0,l.g2)("VideoPlay"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("VideoPause"),v=(0,l.g2)("Close");return a.track?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,s.C4)(["music-player",{"dark-mode":i.isDarkMode}]),style:(0,s.Tr)({width:i.playerWidth})},[(0,l.Lk)("div",{class:"bg-overlay",style:(0,s.Tr)({backgroundImage:`linear-gradient(to top, ${i.getAccentColor}20, transparent)`})},null,4),(0,l.Lk)("div",{class:"player-accent",style:(0,s.Tr)({background:i.getAccentGradient})},null,4),(0,l.Lk)("div",q,[(0,l.Lk)("div",j,[(0,l.Lk)("div",{class:(0,s.C4)(["record-wrapper",{playing:i.isPlaying}])},[(0,l.Lk)("div",G,[(0,l.Lk)("img",{src:a.track.cover,alt:"‰∏ìËæëÂ∞ÅÈù¢",class:"record-cover",loading:"lazy"},null,8,Y),t[11]||(t[11]=(0,l.Lk)("div",{class:"record-texture"},null,-1)),t[12]||(t[12]=(0,l.Lk)("div",{class:"record-center"},[(0,l.Lk)("div",{class:"spindle"})],-1))])],2),(0,l.Lk)("div",{class:(0,s.C4)(["tonearm",{playing:i.isPlaying}])},null,2)]),(0,l.Lk)("div",J,[(0,l.Lk)("div",Z,[(0,l.Lk)("h2",{class:"title",title:a.track.title},[(0,l.Lk)("span",{class:"text","data-text":a.track.title},(0,s.v_)(a.track.title),9,te)],8,ee),(0,l.Lk)("p",{class:"artist",title:a.track.artist},(0,s.v_)(a.track.artist),9,ae),a.track.reason?((0,l.uX)(),(0,l.CE)("p",{key:0,class:"reason",title:a.track.reason},[t[13]||(t[13]=(0,l.Lk)("span",{class:"reason-icon"},"‚ô™",-1)),(0,l.eW)(" "+(0,s.v_)(a.track.reason),1)],8,le)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",se,[(0,l.Lk)("div",re,[(0,l.Lk)("div",{class:"progress-indicator",style:(0,s.Tr)({width:(i.duration>0?i.currentTime/i.duration*100:0)+"%"})},null,4),(0,l.Lk)("input",{ref:"progressSlider",type:"range",min:"0",max:i.duration||100,step:"0.1",value:i.currentTime,onInput:t[0]||(t[0]=(...e)=>i.handleProgressInput&&i.handleProgressInput(...e)),onChange:t[1]||(t[1]=(...e)=>i.handleProgressChange&&i.handleProgressChange(...e)),class:"progress-slider","aria-label":"Êí≠ÊîæËøõÂ∫¶"},null,40,ie)]),(0,l.Lk)("div",oe,[(0,l.Lk)("span",ne,(0,s.v_)(i.formatTime(i.currentTime)),1),(0,l.Lk)("span",ce,(0,s.v_)(i.formatTime(i.duration)),1)])]),(0,l.Lk)("div",ue,[(0,l.Lk)("button",{class:"play-btn",onClick:t[2]||(t[2]=(...e)=>i.togglePlay&&i.togglePlay(...e)),"aria-label":i.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:(0,s.Tr)({background:i.getAccentGradient})},[i.isPlaying?((0,l.uX)(),(0,l.Wv)(u,{key:1,class:"pause-icon"},{default:(0,l.k6)(()=>[(0,l.bF)(d)]),_:1})):((0,l.uX)(),(0,l.Wv)(u,{key:0,class:"play-icon"},{default:(0,l.k6)(()=>[(0,l.bF)(c)]),_:1}))],12,de),(0,l.Lk)("div",ve,[(0,l.Lk)("button",{class:"mute-btn",onClick:t[3]||(t[3]=(...e)=>i.toggleMute&&i.toggleMute(...e)),"aria-pressed":i.isMuted,title:i.isMuted?"ÂèñÊ∂àÈùôÈü≥":"ÈùôÈü≥"},[i.isMuted?((0,l.uX)(),(0,l.CE)("span",me,"üîá")):i.volume>=.66?((0,l.uX)(),(0,l.CE)("span",pe,"üîä")):i.volume>=.33?((0,l.uX)(),(0,l.CE)("span",he,"üîâ")):((0,l.uX)(),(0,l.CE)("span",ke,"üîà"))],8,ge),(0,l.bo)((0,l.Lk)("input",{type:"range",min:"0",max:"1",step:"0.01","onUpdate:modelValue":t[4]||(t[4]=e=>i.volume=e),onInput:t[5]||(t[5]=(...e)=>i.setVolume&&i.setVolume(...e)),class:"volume-slider","aria-label":"Èü≥ÈáèË∞ÉËäÇ"},null,544),[[r.Jo,i.volume,void 0,{number:!0}]])])])]),(0,l.Lk)("button",{class:"close-btn",onClick:t[6]||(t[6]=(...e)=>i.handleClose&&i.handleClose(...e)),"aria-label":"ÂÖ≥Èó≠Êí≠ÊîæÂô®"},[(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)(v)]),_:1})])]),(0,l.Lk)("audio",{ref:"audioEl",src:a.track.src,onTimeupdate:t[7]||(t[7]=(...e)=>i.onTimeUpdate&&i.onTimeUpdate(...e)),onLoadedmetadata:t[8]||(t[8]=(...e)=>i.onLoaded&&i.onLoaded(...e)),onEnded:t[9]||(t[9]=(...e)=>i.onEnded&&i.onEnded(...e)),onError:t[10]||(t[10]=(...e)=>i.handleAudioError&&i.handleAudioError(...e)),class:"audio-element"}," ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅHTML5Èü≥È¢ëÊí≠Êîæ ",40,ye)],6)):(0,l.Q3)("",!0)}a(3579);var be=a(144),Le={name:"MusicPlayer",components:{VideoPlay:B.VideoPlay,VideoPause:B.VideoPause,Close:B.Close},props:{track:{type:Object,required:!0,validator:e=>e&&e.title&&e.artist&&e.src},autoPlay:{type:Boolean,default:!1},accentColor:{type:String,default:"#10b981"}},emits:["close","error"],setup(e,{emit:t}){const a=(0,be.KR)(null),s=(0,be.KR)(null),r=(0,be.KR)(!1),i=(0,be.KR)(0),o=(0,be.KR)(0),n=(0,be.KR)(.05),c=(0,be.KR)(!1),u=(0,be.KR)(!1),d=(0,be.KR)(null),v=(0,be.KR)(!1),g=(0,be.KR)("undefined"!==typeof window?window.innerWidth:1200),m=(0,l.EW)(()=>window.matchMedia("(prefers-color-scheme: dark)").matches),p=(0,l.EW)(()=>e.accentColor||(m.value?"#34d399":"#10b981")),h=(0,l.EW)(()=>{const e=p.value;return`linear-gradient(135deg, ${e}, ${e.replace("1)","9)").replace("399","81")})`}),k=async()=>{if(a.value&&e.track)try{if(!a.value.src||""===a.value.src)return console.error("Êí≠ÊîæÂ§±Ë¥•: Èü≥È¢ëURLÊó†Êïà"),void ElMessage.error("Èü≥È¢ëURLÊó†Êïà");if(r.value=!1,a.value.readyState<2)try{await a.value.load()}catch(t){return console.error("Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•:",t),void ElMessage.error("Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•")}const l=a.value.play();l&&"function"===typeof l.then?(await l,r.value=!0,console.debug("Èü≥È¢ëÊí≠ÊîæÊàêÂäü",{title:e.track.title,url:a.value.src})):r.value=!0}catch(l){console.error("Êí≠ÊîæÊó∂ÂèëÁîüÈîôËØØ:",l),r.value=!1,"NotAllowedError"===l.name||l.message&&l.message.includes("user gesture")?ElMessage.warning("ËØ∑ÁÇπÂáªÊí≠ÊîæÊåâÈíÆ‰ª•ÂºÄÂßãÊí≠ÊîæÈü≥È¢ë"):ElMessage.error("Êí≠ÊîæÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}else console.error("Êí≠ÊîæÂ§±Ë¥•: Áº∫Â∞ëÈü≥È¢ëÂÖÉÁ¥†ÊàñÊõ≤ÁõÆ‰ø°ÊÅØ")},y=()=>{if(a.value)try{console.debug("[MusicPlayer] pause() called"),a.value.pause(),r.value=!1,console.info("[MusicPlayer] paused, isPlaying=",r.value)}catch(e){console.warn("ÊöÇÂÅúÈü≥È¢ëÊó∂ÂèëÁîüË≠¶Âëä:",e)}},f=()=>{r.value?y():k()},b=()=>{if(!a.value||u.value)return;const e=o.value;o.value=a.value.currentTime,Math.abs(o.value-e)>.5&&console.debug("[MusicPlayer] timeupdate ->",o.value.toFixed(2),"/",i)},L=()=>{if(a.value)try{const t=Number(a.value.duration);console.debug("[MusicPlayer] onLoaded: audio.duration=",t),!isNaN(t)&&t>0&&(i.value=t),a.value.volume=n.value,a.value.muted=c.value,e.autoPlay&&setTimeout(()=>k(),300)}catch(t){console.warn("Èü≥È¢ëÂä†ËΩΩÂÆåÊàêÂ§ÑÁêÜÊó∂ÂèëÁîüË≠¶Âëä:",t)}},M=e=>{if(v.value)return;if(!a.value||""===a.value.src)return;console.error("Èü≥È¢ëÈîôËØØ:",e,"Èü≥È¢ëURL:",a.value.src),d.value=e,t("error",{type:"audio_error",event:e,src:a.value.src}),r.value=!1;let l="Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•";if(e&&"error"===e.type)switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:l="Êí≠ÊîæÂ∑≤Ë¢´ÂèñÊ∂à";break;case e.target.error.MEDIA_ERR_NETWORK:l="ÁΩëÁªúÈîôËØØÂØºËá¥Êí≠ÊîæÂ§±Ë¥•";break;case e.target.error.MEDIA_ERR_DECODE:l="Èü≥È¢ëÊ†ºÂºè‰∏çÊîØÊåÅÊàñÂ∑≤ÊçüÂùè";break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:l="Êó†Ê≥ïÂä†ËΩΩÈü≥È¢ëÊñá‰ª∂";break;default:l="Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•ÔºåËØ∑Â∞ùËØïÂÖ∂‰ªñÈü≥‰πê"}ElMessage.error(l)},w=e=>{if(!a.value)return;const t=parseFloat(e.target.value);u.value=!0,o.value=t,console.debug("[MusicPlayer] handleProgressInput newTime=",t,"isSeeking=",u.value)},_=async e=>{if(!a.value)return;const t=parseFloat(e.target.value),s=Math.max(0,Math.min(t,i.value));o.value=s,console.debug("[MusicPlayer] handleProgressChange -> applying time=",s);try{a.value.currentTime=s}catch(n){console.warn("ËÆæÁΩÆÈü≥È¢ëÊó∂Èó¥Êó∂ÂèëÁîüË≠¶Âëä:",n)}if(await(0,l.dY)(),u.value=!1,r.value)try{await a.value.play(),console.debug("[MusicPlayer] resumed play after change")}catch(n){console.error("ÊÅ¢Â§çÊí≠ÊîæÂ§±Ë¥•:",n),r.value=!1}},F=()=>{if(a.value)try{a.value.volume=n.value,n.value>0&&(c.value=!1),a.value.muted=c.value}catch(e){console.warn("ËÆæÁΩÆÈü≥ÈáèÊó∂ÂèëÁîüË≠¶Âëä:",e)}},C=()=>{if(c.value=!c.value,a.value)try{a.value.muted=c.value}catch(e){console.warn("ÂàáÊç¢ÈùôÈü≥Êó∂ÂèëÁîüË≠¶Âëä:",e)}},P=()=>{r.value=!1,o.value=0};(0,l.wB)(()=>e.track,t=>{E();try{if(t&&t.duration){const e=U(t.duration);null!=e&&(i.value=e)}}catch(l){}setTimeout(()=>{if(a.value)try{a.value.volume=n.value,a.value.muted=c.value}catch(l){console.warn("ÂàáÊç¢ËΩ®ÈÅìÊó∂ËÆæÁΩÆÈü≥ÈáèÂíåÈùôÈü≥Áä∂ÊÄÅÂèëÁîüË≠¶Âëä:",l)}e.autoPlay&&t&&k()},100)},{deep:!0}),(0,l.wB)([n,c],()=>{if(a.value)try{a.value.volume=n.value,a.value.muted=c.value}catch(e){console.warn("ÁõëÂê¨Èü≥ÈáèÂèòÂåñÊó∂ÂèëÁîüË≠¶Âëä:",e)}});const E=()=>{o.value=0,i.value=0,r.value=!1,u.value=!1,d.value=null},x=()=>{if(a.value)try{a.value.pause(),a.value.onerror=null,a.value.ontimeupdate=null,a.value.onloadedmetadata=null,a.value.onended=null,a.value.src="",a.value.load()}catch(e){console.warn("Ê∏ÖÁêÜÈü≥È¢ëËµÑÊ∫êÊó∂ÂèëÁîüË≠¶Âëä:",e)}},T=()=>{v.value=!0,y(),x(),E(),setTimeout(()=>{t("close"),v.value=!1},50)};(0,l.xo)(()=>{x();try{window.removeEventListener("resize",R)}catch(e){}});const R=()=>{try{g.value=window.innerWidth}catch(e){}};try{window.addEventListener("resize",R)}catch(W){}const S=(0,l.EW)(()=>{const t=380,a=Math.min(920,Math.floor(.92*g.value)),l=e.track&&e.track.title?String(e.track.title).length:0,s=Math.min(360,8*l),r=420,i=Math.max(t,Math.min(a,r+s));return`${i}px`}),V=e=>{if(!e||isNaN(e))return"00:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`},U=e=>{if(null==e)return null;if("number"===typeof e)return isNaN(e)?null:e;const t=String(e).trim();if(""===t)return null;if(/^\d+(\.\d+)?$/.test(t))return Number(t);const a=t.split(":").map(e=>Number(e));return a.some(e=>isNaN(e))?null:2===a.length?60*a[0]+a[1]:3===a.length?3600*a[0]+60*a[1]+a[2]:null};return{audioEl:a,progressSlider:s,isPlaying:r,duration:i,currentTime:o,volume:n,isMuted:c,isSeeking:u,togglePlay:f,onTimeUpdate:b,onLoaded:L,onEnded:P,handleProgressInput:w,handleProgressChange:_,formatTime:V,setVolume:F,toggleMute:C,isDarkMode:m,handleClose:T,handleAudioError:M,getAccentColor:p,getAccentGradient:h,playerWidth:S}}},Me=a(1241);const we=(0,Me.A)(Le,[["render",fe],["__scopeId","data-v-26877278"]]);var _e=we,Fe=a(5720),Ce=a(1219),Pe=a(9267),Ee=a(47),xe=a(6018),Te={name:"MusicRecommendationView",components:{Headset:B.Headset,VideoPlay:B.VideoPlay,Upload:B.Upload,Loading:B.Loading,Picture:B.Picture,Check:B.Check,MusicPlayer:_e,ElDialog:Pe.kZ,ElButton:Ee.S2,ElSelect:xe.AV,ElOption:xe.P9,Microphone:B.Microphone,UploadFilled:B.UploadFilled},data(){return{currentFatigueLevel:this.$route?.query?.fatigue||localStorage.getItem("current_fatigue_level")||"Medium",loading:!1,musicList:[],displayedMusicList:[],currentPage:1,pageSize:12,observer:null,loadMoreObserver:null,isLoadingMore:!1,loadMoreTrigger:null,selectedTrack:null,showPlayer:!1,autoPlay:function(){try{const e=JSON.parse(localStorage.getItem("user")||"null");return"true"===e?.preferences?.auto_play}catch(e){return!1}}(),showAddDialog:!1,newMusic:{title:"",artist:"",duration:"",cover:"",reason:"",music_type:"natural",fatigue_level:"medium",match_rate:50,audio_url:""},selectedFile:null,selectedFileName:"",uploading:!1,uploadProgress:0,selectedCoverFile:null,selectedCoverFileName:"",uploadingCover:!1,coverUploadProgress:0}},computed:{totalPages(){return Math.ceil(this.musicList.length/this.pageSize)},hasMoreMusic(){return this.currentPage<this.totalPages&&!this.loading},fatigueTagType(){const e=this.currentFatigueLevel.toLowerCase();return e.includes("light")||e.includes("‰Ωé")?"info":e.includes("medium")||e.includes("‰∏≠")?"warning":e.includes("heavy")||e.includes("È´ò")||e.includes("Èáç")?"danger":"info"}},methods:{updateDisplayedMusicList(){const e=Array.isArray(this.musicList)?this.musicList:[],t=e.map(e=>({...e,id:e.id||`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:e.title||"Êú™Áü•Ê≠åÊõ≤",artist:e.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂",duration:e.duration||"00:00",match_rate:e.match_rate||0,reason:e.reason||"ÊöÇÊó†Êé®ËçêÁêÜÁî±",cover:e.cover||e.cover_url||"/static/music_cover/placeholder.png"})),a=(this.currentPage-1)*this.pageSize,l=a+this.pageSize;this.displayedMusicList=t.slice(a,l),console.log("[MusicRecommendation] ÊòæÁ§∫ÁöÑÈü≥‰πêÊï∞Èáè:",this.displayedMusicList.length),this.$nextTick(()=>{this.handleScroll()})},loadMoreMusic(){this.currentPage<this.totalPages&&!this.isLoadingMore&&(this.isLoadingMore=!0,this.currentPage++,this.updateDisplayedMusicList(),this.$nextTick(()=>{this.isLoadingMore=!1}))},refreshCurrentPage(){this.currentPage=1,this.updateDisplayedMusicList()},getCoverUrl(e){if(!e)return"/static/music_cover/placeholder.png";const t=e.cover||e.cover_url;if(!t)return"/static/music_cover/placeholder.png";const a=String(t);return a.startsWith("http")||a.startsWith("/")?a:`/${a}`},observeMusicCard(e){if(e&&!e.dataset.observed){e.dataset.observed="true",e.style.opacity="1",e.style.transform="translateY(0)";try{const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("animate-in")},10),t.unobserve(e.target))})},{rootMargin:"100px 0px",threshold:.05});t.observe(e)}catch(t){console.warn("Âç°ÁâáËßÇÂØüÂô®ÂàùÂßãÂåñÂ§±Ë¥•:",t)}}},openAddDialog(){const e=e=>{if(!e)return"medium";const t=String(e).trim().toLowerCase();return"high"===t?"heavy":"low"===t?"light":"heavy"===t||"light"===t||"medium"===t?t:"high"===t||"low"===t?"high"===t?"heavy":"light":"medium"};try{this.newMusic.fatigue_level=e(this.currentFatigueLevel)}catch(t){}this.showAddDialog=!0},handleImageError(e,t){const a=e.target;a.src="/static/music_cover/placeholder.png",t&&(t.cover="/static/music_cover/placeholder.png")},handleScroll(){"IntersectionObserver"in window&&!this.observer?(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate-in"),this.observer.unobserve(e.target))})},{rootMargin:"100px 0px",threshold:.1}),document.querySelectorAll(".music-card:not(.animate-in)").forEach(e=>{this.observer.observe(e)})):window.requestAnimationFrame(()=>{const e=document.querySelectorAll(".music-card:not(.animate-in)");Array.from(e).slice(0,10).forEach(e=>{const t=e.getBoundingClientRect(),a=t.top<window.innerHeight+100;a&&e.classList.add("animate-in")})})},async loadMusic(){this.loading=!0;try{let t=null;const a=(this.currentFatigueLevel||"Medium").toLowerCase(),l=[{id:1,title:"ËΩªÊüîÈí¢Áê¥Êõ≤",artist:"Êú™Áü•Ëâ∫ÊúØÂÆ∂",duration:"02:34",match_rate:95,reason:"ËàíÁºìÁöÑÈí¢Áê¥Êõ≤ÊúâÂä©‰∫éÁºìËß£ËΩªÂ∫¶Áñ≤Âä≥",cover:"/static/music_cover/placeholder.png"},{id:2,title:"Ëá™ÁÑ∂Èõ®Â£∞",artist:"ÁéØÂ¢ÉÈü≥‰πê",duration:"05:12",match_rate:88,reason:"Ëá™ÁÑ∂Èü≥ÊïàËÉΩÂ§üÂ∏ÆÂä©ÊîæÊùæÂøÉÊÉÖ",cover:"/static/music_cover/placeholder.png"},{id:3,title:"ÂÜ•ÊÉ≥Èü≥‰πê",artist:"ÂÜ•ÊÉ≥Â§ßÂ∏à",duration:"10:00",match_rate:92,reason:"ÈÄÇÂêàÊ∑±Â∫¶ÊîæÊùæÔºåÁºìËß£Â∑•‰ΩúÂéãÂäõ",cover:"/static/music_cover/placeholder.png"}];try{t=await Fe.f.get("/music/recommend",{fatigue_level:a}),t&&t.data&&t.data.music_list&&t.data.music_list.length>0?(this.musicList=t.data.music_list,console.log("[MusicRecommendation] ÊàêÂäüÂä†ËΩΩÊé®ËçêÈü≥‰πê:",this.musicList.length)):(console.log("Êé®ËçêÊé•Âè£ËøîÂõûÁ©∫Êï∞ÊçÆÔºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ"),this.musicList=l)}catch(e){console.log("Êé®ËçêÊé•Âè£Ë∞ÉÁî®Â§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆËøõË°åÊµãËØï",e),this.musicList=l}this.currentPage=1,this.updateDisplayedMusicList()}catch(e){console.error("Âä†ËΩΩÈü≥‰πêÂ§±Ë¥•",e),Ce.nk.error("Âä†ËΩΩÈü≥‰πêÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}finally{this.loading=!1}},playTrack(e){if(console.debug("[MusicRecommendation] playTrack called, music=",e),!e)return console.error("[MusicRecommendation] Invalid music parameter:",e),void Ce.nk.error("Êí≠ÊîæÂ§±Ë¥•ÔºöÈü≥‰πê‰ø°ÊÅØÊó†Êïà");const t={...e};try{if(!t.src&&t.audio_url){let e=t.audio_url;!e||"string"!==typeof e||e.startsWith("http")||e.startsWith("/")||(e=`/${e}`),t.src=e}else t.src||(t.src=`/static/music/sample${t.id||1}.mp3`);t.cover_url&&!t.cover&&(t.cover=t.cover_url);const e=e=>{if(null==e)return null;if("number"===typeof e)return e;if(/^\d+$/.test(String(e)))return Number(e);const t=String(e).split(":").map(e=>Number(e));return 2!==t.length||isNaN(t[0])||isNaN(t[1])?3===t.length&&t.every(e=>!isNaN(e))?3600*t[0]+60*t[1]+t[2]:null:60*t[0]+t[1]},a=e(t.duration);t.duration=null!=a?a:0,console.debug("[MusicRecommendation] Processed track:",{id:t.id,title:t.title,src:t.src,duration:t.duration})}catch(a){return console.error("[MusicRecommendation] Error processing track:",a),void Ce.nk.error("Êí≠ÊîæÂ§±Ë¥•ÔºöÈü≥‰πêÊï∞ÊçÆÂ§ÑÁêÜÈîôËØØ")}this.selectedTrack=t,this.showPlayer=!0},async addMusic(){try{if(!this.newMusic.title)return void Ce.nk.warning("ËØ∑Â°´ÂÜôÈü≥‰πêÊ†áÈ¢ò");const e={...this.newMusic};e.audio_url&&(e.src=e.audio_url,delete e.audio_url);const t=await Fe.f.post("/music",e);if(t&&200===t.code){Ce.nk.success("Ê∑ªÂä†ÊàêÂäü"),this.showAddDialog=!1;const e=e=>{if(!e)return"medium";const t=String(e).trim().toLowerCase();return"high"===t?"heavy":"low"===t?"light":["heavy","light","medium"].includes(t)?t:"medium"};this.newMusic={title:"",artist:"",duration:"",cover:"",reason:"",music_type:"natural",fatigue_level:e(this.currentFatigueLevel),match_rate:50,audio_url:""},await this.loadMusic()}else Ce.nk.error(t?.msg||"Ê∑ªÂä†Â§±Ë¥•")}catch(e){console.error("Ê∑ªÂä†Èü≥‰πêÂ§±Ë¥•",e),Ce.nk.error("Ê∑ªÂä†Èü≥‰πêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÂèÇÊï∞")}},onFileChange(e){const t=e.target.files&&e.target.files[0];if(!t)return;this.selectedFile=t,this.selectedFileName=t.name;const a=t.name.replace(/\.[^/.]+$/,"");this.newMusic.title=a.replace(/[_-]+/g," "),this.newMusic.duration="",this.computeDurationFromFile(t).then(e=>{e&&(this.newMusic.duration=e)}).catch(()=>{})},computeDurationFromFile(e){return new Promise(t=>{try{const a=URL.createObjectURL(e),l=new Audio;l.src=a,l.addEventListener("loadedmetadata",()=>{const e=Math.floor(l.duration||0);URL.revokeObjectURL(a);const s=String(Math.floor(e/60)).padStart(2,"0"),r=String(e%60).padStart(2,"0");t(`${s}:${r}`)}),l.addEventListener("error",()=>{URL.revokeObjectURL(a),t(null)})}catch(a){t(null)}})},async uploadFile(){if(this.selectedFile)try{this.uploading=!0,this.uploadProgress=0;const e=new FormData;e.append("file",this.selectedFile);const t=await Fe.A.post("/music/upload",e,{onUploadProgress:e=>{e.total&&(this.uploadProgress=Math.round(100*e.loaded/e.total))}});if(t&&200===t.code&&t.data&&t.data.src){const e=t.data;this.newMusic.audio_url=e.src,this.newMusic.src=e.src,e.title&&(this.newMusic.title=e.title),e.artist&&(this.newMusic.artist=e.artist),e.duration&&(this.newMusic.duration=e.duration),e.cover&&(this.newMusic.cover=e.cover),Ce.nk.success("‰∏ä‰º†ÊàêÂäüÔºåÂ∑≤Â°´ÂÖÖÈü≥È¢ë‰ø°ÊÅØ")}else Ce.nk.error(t?.msg||"‰∏ä‰º†Â§±Ë¥•")}catch(e){console.error("‰∏ä‰º†Â§±Ë¥•",e),Ce.nk.error("‰∏ä‰º†Â§±Ë¥•")}finally{this.uploading=!1;try{this.$refs.fileInput.value=null}catch(e){}this.uploadProgress=0}else Ce.nk.warning("ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂")},onCoverChange(e){const t=e.target.files&&e.target.files[0];t&&(this.selectedCoverFile=t,this.selectedCoverFileName=t.name)},async uploadCover(){if(this.selectedCoverFile)try{this.uploadingCover=!0,this.coverUploadProgress=0;const e=new FormData;e.append("file",this.selectedCoverFile);const t=await Fe.A.post("/music/upload_cover",e,{onUploadProgress:e=>{e.total&&(this.coverUploadProgress=Math.round(100*e.loaded/e.total))}});t&&200===t.code&&t.data&&t.data.cover?(this.newMusic.cover=t.data.cover,Ce.nk.success("Â∞ÅÈù¢‰∏ä‰º†ÊàêÂäü")):Ce.nk.error(t?.msg||"Â∞ÅÈù¢‰∏ä‰º†Â§±Ë¥•")}catch(e){console.error("Â∞ÅÈù¢‰∏ä‰º†Â§±Ë¥•",e),Ce.nk.error("‰∏ä‰º†Â∞ÅÈù¢Â§±Ë¥•")}finally{this.uploadingCover=!1;try{this.$refs.coverInput.value=null}catch(e){}this.coverUploadProgress=0}else Ce.nk.warning("ËØ∑ÂÖàÈÄâÊã©Â∞ÅÈù¢Êñá‰ª∂")},async deleteMusic(e){try{await Fe.f.delete(`/music/${e}`,{delete_files:!0}),Ce.nk.success("Âà†Èô§ÊàêÂäü"),this.musicList=this.musicList.filter(t=>t.id!==e),this.updateDisplayedMusicList()}catch(t){console.error("Âà†Èô§Èü≥‰πêÂ§±Ë¥•",t),Ce.nk.error("Âà†Èô§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}}},mounted(){const e=this.$route?.query?.fatigue;if(e){try{localStorage.setItem("current_fatigue_level",e)}catch(a){}this.currentFatigueLevel=e}else this.currentFatigueLevel=localStorage.getItem("current_fatigue_level")||this.currentFatigueLevel;this.loadMusic(),this.$nextTick(()=>{"IntersectionObserver"in window&&(this.loadMoreObserver=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.hasMoreMusic&&!this.isLoadingMore&&this.loadMoreMusic()})},{rootMargin:"100px 0px",threshold:.1}),this.$refs.loadMoreTrigger&&this.loadMoreObserver.observe(this.$refs.loadMoreTrigger))});let t=null;window.addEventListener("scroll",()=>{t||(t=setTimeout(()=>{this.handleScroll(),window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&this.loadMoreMusic(),t=null},100))})},beforeUnmount(){this.observer&&this.observer.disconnect(),this.loadMoreObserver&&this.loadMoreObserver.disconnect(),window.removeEventListener("scroll",this.handleScroll)}};const Re=(0,Me.A)(Te,[["render",H],["__scopeId","data-v-1c603415"]]);var Se=Re}}]);
//# sourceMappingURL=music.4b55a922.js.map